# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
"Proxy error: Server disconnected without sending a response."
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤:

1. **–§–∞–π–ª 1.4MB (8 —Å—Ç—Ä–∞–Ω–∏—Ü)** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**
   - –°—Ç–∞—Ç—É—Å: 200 OK
   - –û–±—Ä–∞–±–æ—Ç–∫–∞: –£—Å–ø–µ—à–Ω–∞—è
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω

2. **–§–∞–π–ª 3.2MB (13 —Å—Ç—Ä–∞–Ω–∏—Ü)** ‚ùå **–ù–ï –†–ê–ë–û–¢–ê–ï–¢**
   - –°—Ç–∞—Ç—É—Å: 500 Internal Server Error
   - –û—à–∏–±–∫–∞: "Proxy error: Server disconnected without sending a response"
   - –ü—Ä–æ–±–ª–µ–º–∞: Document-parser –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

3. **–§–∞–π–ª 14MB (47 —Å—Ç—Ä–∞–Ω–∏—Ü)** ‚ùå **–ù–ï –†–ê–ë–û–¢–ê–ï–¢**
   - –°—Ç–∞—Ç—É—Å: 500 Internal Server Error
   - –û—à–∏–±–∫–∞: "Proxy error: Server disconnected without sending a response"
   - –ü—Ä–æ–±–ª–µ–º–∞: Document-parser –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤:

```
INFO:main:Processing PDF with 13 pages
INFO:main:Connected to PostgreSQL
INFO:main:Connected to Qdrant
INFO:     Started server process [1]  # ‚Üê –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8001
```

## üîß –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ document-parser**
- Document-parser –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF
- –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–æ–≤ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü > 8
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
  - –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö PDF
  - –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
  - –û—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π PDF**
- –§—É–Ω–∫—Ü–∏—è `parse_pdf()` –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤**
- Gateway: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- Nginx: 300 —Å–µ–∫—É–Ω–¥
- Uvicorn: 300 —Å–µ–∫—É–Ω–¥
- –ù–æ document-parser –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞**
```python
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB
if file.size and file.size > MAX_FILE_SIZE:
    raise HTTPException(
        status_code=413, 
        detail=f"File too large. Maximum size is {MAX_FILE_SIZE // (1024*1024)}MB"
    )
```

### 2. **–£–ª—É—á—à–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ uvicorn**
```dockerfile
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001", 
     "--timeout-keep-alive", "300", "--limit-max-requests", "1000", 
     "--limit-concurrency", "10"]
```

### 3. **Middleware –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤**
```python
class LargeFileMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request: Request, call_next):
        if request.url.path == "/upload" or request.url.path == "/upload/checkable":
            request.scope["max_content_size"] = 100 * 1024 * 1024  # 100MB
        return await call_next(request)
```

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

### 1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –¥–æ 10MB
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ –ª–∏–º–∏—Ç–∞—Ö
- ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### 2. **–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
- üîÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É PDF
- üîÑ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- üîÑ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã

### 3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
- üîÑ –†–∞–∑–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ —ç—Ç–∞–ø—ã
- üîÑ –î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Celery/RQ)
- üîÑ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ —á–∞—Å—Ç—è–º

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 1.4MB
- –û–±—Ä–∞–±–æ—Ç–∫–∞ PDF –¥–æ 8 —Å—Ç—Ä–∞–Ω–∏—Ü
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ > 1.4MB
- –û–±—Ä–∞–±–æ—Ç–∫–∞ PDF > 8 —Å—Ç—Ä–∞–Ω–∏—Ü
- –ë–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤—ã–∑—ã–≤–∞—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–≤—è–∑–∞–Ω–∞ —Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º document-parser –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ 1.4MB, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ 10MB
2. –†–∞–∑–±–∏–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —á–∞—Å—Ç–∏
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —ç—Ç–∞–ø–∞–º
