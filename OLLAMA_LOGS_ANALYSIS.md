# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ Ollama

## üìä **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Ollama**

### üîç **–õ–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞:**
```
llama_context: constructing llama_context
llama_context: n_seq_max     = 1
llama_context: n_ctx         = 4096
llama_context: n_ctx_per_seq = 4096
llama_context: n_batch       = 512
llama_context: n_ubatch      = 512
llama_context: causal_attn   = 1
llama_context: flash_attn    = 0
llama_context: freq_base     = 500000.0
llama_context: freq_scale    = 1
llama_context: n_ctx_per_seq (4096) < n_ctx_train (131072) -- the full capacity of the model will not be utilized
llama_context:        CPU  output buffer size =     0.50 MiB
llama_kv_cache_unified: kv_size = 4096, type_k = 'f16', type_v = 'f16', n_layer = 32, can_shift = 1, padding = 32
llama_kv_cache_unified:        CPU KV buffer size =   512.00 MiB
llama_kv_cache_unified: KV self size  =  512.00 MiB, K (f16):  256.00 MiB, V (f16):  256.00 MiB
llama_context:        CPU compute buffer size =   296.01 MiB
llama_context: graph nodes  = 1094
llama_context: graph splits = 1
time=2025-08-25T04:49:17.161Z level=INFO source=server.go:637 msg="llama runner started in 5.56 seconds"
```

## ‚ö†Ô∏è **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

### 1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**
- **–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:** 4,096 —Ç–æ–∫–µ–Ω–æ–≤
- **–û–±—É—á–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:** 131,072 —Ç–æ–∫–µ–Ω–∞
- **–ü–æ—Ç–µ—Ä—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞:** ~97% –æ—Ç –ø–æ–ª–Ω–æ–π –µ–º–∫–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**
- **–û–±—â–∞—è –ø–∞–º—è—Ç—å:** ~808.51 MiB
- **KV –∫—ç—à:** 512.00 MiB (63% –æ—Ç –æ–±—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- **Compute buffer:** 296.01 MiB (37% –æ—Ç –æ–±—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- **Output buffer:** 0.50 MiB (<1% –æ—Ç –æ–±—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

## üìà **–ê–Ω–∞–ª–∏–∑ –º–æ–¥–µ–ª–∏**

### üîç **–ú–æ–¥–µ–ª—å:** `llama3.1:8b`
- **–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏:** 4.92 GB
- **–ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è:** Q4_K_M (—Å—Ä–µ–¥–Ω—è—è –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** 8.0B
- **–§–æ—Ä–º–∞—Ç:** GGUF

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

### ‚úÖ 1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** `n_ctx_per_seq (4096) < n_ctx_train (131072)`

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Ollama

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π:** 8,192 —Ç–æ–∫–µ–Ω–æ–≤ (2x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ)
- **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π:** 16,384 —Ç–æ–∫–µ–Ω–æ–≤ (4x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π:** 32,768 —Ç–æ–∫–µ–Ω–æ–≤ (8x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ)

### ‚úÖ 2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏**

**–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** 808.51 MiB –∏–∑ 6GB –¥–æ—Å—Ç—É–ø–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- ‚úÖ **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏** –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ **KV –∫—ç—à** –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **Compute buffer** –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á

### ‚úÖ 3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `n_batch = 512` - —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
- `n_ubatch = 512` - —Ä–∞–∑–º–µ—Ä unary –±–∞—Ç—á–∞
- `flash_attn = 0` - Flash Attention –æ—Ç–∫–ª—é—á–µ–Ω

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- ‚úÖ **–í–∫–ª—é—á–∏—Ç—å Flash Attention** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞** –ø–æ–¥ –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–∞–º—è—Ç—å

## üîß **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏**

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ Modelfile –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

```modelfile
FROM llama3.1:8b

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
PARAMETER num_ctx 16384

# –í–∫–ª—é—á–µ–Ω–∏–µ Flash Attention
PARAMETER flash_attn 1

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞—Ç—á–∞
PARAMETER num_batch 1024

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è
PARAMETER temperature 0.1
```

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yaml**

```yaml
ollama:
  image: ollama/ollama:latest
  environment:
    - OLLAMA_HOST=0.0.0.0
    - OLLAMA_ORIGINS=*
    # –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    - OLLAMA_NUM_CTX=16384
    - OLLAMA_FLASH_ATTN=1
```

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è

## üìä **–û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

### ‚úÖ **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** 4x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ (4,096 ‚Üí 16,384 —Ç–æ–∫–µ–Ω–æ–≤)
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 20-30% —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å Flash Attention
3. **–ö–∞—á–µ—Å—Ç–≤–æ:** –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ë–æ–ª–µ–µ –ø–æ–ª–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –º–æ–¥–µ–ª–∏

## üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

### üî• **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ 16,384 —Ç–æ–∫–µ–Ω–æ–≤
2. ‚úÖ –í–∫–ª—é—á–∏—Ç—å Flash Attention
3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞

### üî∂ **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è
3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è KV –∫—ç—à–∞

### üîµ **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. ‚úÖ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è–º–∏
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π
3. ‚úÖ –î–∞–ª—å–Ω–µ–π—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üìà **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

### ‚úÖ **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ **–ú–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç** —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ **–ü–∞–º—è—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚ö†Ô∏è **–ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω** (4,096 —Ç–æ–∫–µ–Ω–æ–≤)
- ‚ö†Ô∏è **Flash Attention –æ—Ç–∫–ª—é—á–µ–Ω**

### üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ 16,384 —Ç–æ–∫–µ–Ω–æ–≤
2. ‚úÖ **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:** –í–∫–ª—é—á–∏—Ç—å Flash Attention
3. ‚úÖ **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### üìä **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **4x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ** –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ **20-30% —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ **–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ** –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è
- ‚úÖ **–ü–æ–ª–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –º–æ–¥–µ–ª–∏
