# 🔄 Схема выполнения иерархической проверки документов AI-NK

## 📊 Визуальная схема процесса

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ИЕРАРХИЧЕСКАЯ ПРОВЕРКА ДОКУМЕНТОВ                    │
│                              AI-NK SYSTEM                                      │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ВХОДНЫЕ ДАННЫЕ                                    │
│  • Документ для проверки (PDF/DOCX)                                           │
│  • А9.2.МТН.03 Методика по оформлению ТД (ПИР)                               │
│  • Перечень НТД для руководства внутри ОНК по маркам                          │
│  • Чек-лист перед НК ПТИ                                                      │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 1: АНАЛИЗ ПЕРВОЙ СТРАНИЦЫ                       │
│                              (Quick Analysis)                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  1.1 Получение  │    │  1.2 Извлечение │    │  1.3 Извлечение │    │  1.4 Определение│
│  содержимого    │───▶│  информации о   │───▶│  метаданных     │───▶│  типа проекта   │
│  первой страницы│    │  проекте        │    │  документа      │    │  и стадии       │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • Текст PDF     │    │ • Шифр проекта  │    │ • Тип документа │    │ • Стадия (РД/ПД)│
│ • Структура     │    │ • Название      │    │ • Марка (АР/КР) │    │ • Марка комплекта│
│ • Форматирование│    │ • Стадия        │    │ • Масштаб       │    │ • Приоритет     │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 2: ОПРЕДЕЛЕНИЕ РЕЛЕВАНТНЫХ НТД                  │
│                         (Relevant NTD Determination)                           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  2.1 Загрузка   │    │  2.2 Определение│    │  2.3 Поиск по   │    │  2.4 Формирование│
│  перечня НТД    │───▶│  марки комплекта│───▶│  стадии         │───▶│  списка         │
│  по маркам      │    │  документа      │    │  проектирования │    │  релевантных НТД│
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • АР: СП 22.13330│    │ • АР - Архитект.│    │ • РД: ГОСТ 21.101│    │ • Базовые НТД   │
│ • КР: СП 63.13330│    │ • КР - Конструкт.│    │ • ПД: ПП РФ 87  │    │ • Специфичные   │
│ • ОВ: СП 60.13330│    │ • ОВ - Отопление │    │ • ЭД: СП 48.13330│    │ • Дополнительные│
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 3: ПРОВЕРКА СООТВЕТСТВИЯ НОРМАМ                 │
│                            (Norm Compliance Check)                             │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  3.1 Гибридный  │    │  3.2 Анализ     │    │  3.3 Проверка   │    │  3.4 Классификация│
│  поиск по НТД   │───▶│  каждой страницы│───▶│  соответствия   │───▶│  нарушений      │
│  (Dense+BM25)   │    │  документа      │    │  требованиям    │    │  по критичности │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • Векторный     │    │ • Извлечение    │    │ • Сопоставление │    │ • Критические   │
│ • Семантический │    │ • Парсинг       │    │ • Валидация     │    │ • Предупреждения│
│ • Контекстный   │    │ • Структуризация│    │ • Проверка      │    │ • Информационные│
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 4: ПРОВЕРКА ПО А9.2.МТН.03                     │
│                        (A9.2.MTN.03 Compliance Check)                         │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  4.1 Проверка   │    │  4.2 Проверка   │    │  4.3 Проверка   │    │  4.4 Проверка   │
│  обязательных   │───▶│  рекомендуемых  │───▶│  технических    │───▶│  качества       │
│  разделов       │    │  требований     │    │  требований     │    │  оформления     │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • Титульный лист│    │ • Детализация   │    │ • Масштабы      │    │ • Графика       │
│ • Общие данные  │    │ • Пояснения     │    │ • Условные      │    │ • Текст         │
│ • Спецификация  │    │ • Дополнения    │    │ • Обозначения   │    │ • Размеры       │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 5: АНАЛИЗ РАЗДЕЛОВ ДОКУМЕНТА                    │
│                          (Document Sections Analysis)                          │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  5.1 Идентификация│    │  5.2 Определение│    │  5.3 Установка  │    │  5.4 Специализированная│
│  разделов       │───▶│  границ         │───▶│  приоритетов    │───▶│  проверка       │
│  документа      │    │  разделов       │    │  проверки       │    │  по разделам    │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • Общие данные  │    │ • Начало/конец  │    │ • Высокий       │    │ • Полнота       │
│ • Спецификация  │    │ • Количество    │    │ • Средний       │    │ • Соответствие  │
│ • Узлы/детали   │    │ • Содержание    │    │ • Нормальный    │    │ • Детализация   │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 6: ПРОВЕРКА ПО ЧЕК-ЛИСТУ                        │
│                         (Checklist Compliance Check)                           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  6.1 Загрузка   │    │  6.2 Проверка   │    │  6.3 Определение│    │  6.4 Сопоставление│
│  чек-листа      │───▶│  каждого пункта │───▶│  статуса        │───▶│  с результатами │
│  "Чек-лист      │    │  чек-листа      │    │  (Пройден/      │    │  проверки       │
│  перед НК ПТИ"  │    │                 │    │  Не пройден)    │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • Общие требования│    │ • Наличие       │    │ • ✅ Пройден    │    │ • Связывание    │
│ • Технические   │    │ • Соответствие  │    │ • ❌ Не пройден  │    │ • Валидация     │
│ • Качество      │    │ • Полнота       │    │ • ⚠️ Частично    │    │ • Корреляция    │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ЭТАП 7: ГЕНЕРАЦИЯ ИТОГОВОГО ОТЧЕТА                   │
│                            (Final Report Generation)                           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  7.1 Создание   │    │  7.2 Генерация  │    │  7.3 Добавление │    │  7.4 Экспорт    │
│  итоговой       │───▶│  рекомендаций   │───▶│  метрик         │───▶│  в PDF/DOCX     │
│  таблицы        │    │  по устранению  │    │  качества       │    │  форматы        │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │                       │                       │
        ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ • Таблица       │    │ • Приоритизация │    │ • Процент       │    │ • Структурированный│
│ • Цветовая      │    │ • Детализация   │    │ • Баллы         │    │ • Интерактивный │
│ • Статистика    │    │ • Ссылки на НТД │    │ • Тренды        │    │ • Печатный      │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                РЕЗУЛЬТАТЫ                                      │
│  • Итоговая таблица - Чек-лист со статусом проверки каждого пункта            │
│  • Детальный отчет по нарушениям с рекомендациями                             │
│  • Метрики качества и соответствия требованиям                                │
│  • Экспорт в PDF/DOCX для дальнейшего использования                           │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 Поток данных между этапами

```
ВХОДНЫЕ ДАННЫЕ
      │
      ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Документ  │───▶│   А9.2.МТН.03│───▶│  Перечень   │
│  для проверки│    │   Методика  │    │  НТД по     │
│             │    │             │    │  маркам     │
└─────────────┘    └─────────────┘    └─────────────┘
      │                   │                   │
      ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 1: АНАЛИЗ ПЕРВОЙ СТРАНИЦЫ           │
│  • Извлечение информации о проекте                     │
│  • Определение типа документа и стадии                 │
│  • Получение метаданных                                │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 2: ОПРЕДЕЛЕНИЕ РЕЛЕВАНТНЫХ НТД      │
│  • Загрузка перечня НТД по маркам                      │
│  • Определение релевантных нормативных документов      │
│  • Формирование списка для проверки                    │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 3: ПРОВЕРКА СООТВЕТСТВИЯ НОРМАМ     │
│  • Гибридный поиск по релевантным НТД                  │
│  • Анализ каждой страницы документа                    │
│  • Выявление нарушений и несоответствий                │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 4: ПРОВЕРКА ПО А9.2.МТН.03         │
│  • Проверка обязательных разделов                      │
│  • Проверка рекомендуемых требований                   │
│  • Проверка технических требований                     │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 5: АНАЛИЗ РАЗДЕЛОВ ДОКУМЕНТА        │
│  • Идентификация разделов документа                    │
│  • Определение границ и приоритетов                    │
│  • Специализированная проверка по разделам             │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 6: ПРОВЕРКА ПО ЧЕК-ЛИСТУ            │
│  • Загрузка чек-листа "Чек-лист перед НК ПТИ"          │
│  • Проверка каждого пункта чек-листа                   │
│  • Определение статуса (Пройден/Не пройден)            │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                ЭТАП 7: ГЕНЕРАЦИЯ ИТОГОВОГО ОТЧЕТА       │
│  • Создание итоговой таблицы - Чек-лист                │
│  • Генерация рекомендаций по устранению                │
│  • Добавление метрик качества                          │
│  • Экспорт в PDF/DOCX форматы                          │
└─────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────┐
│                        РЕЗУЛЬТАТЫ                      │
│  • Итоговая таблица - Чек-лист со статусом             │
│  • Детальный отчет по нарушениям                       │
│  • Метрики качества и соответствия                     │
│  • Экспорт в PDF/DOCX                                  │
└─────────────────────────────────────────────────────────┘
```

## 📊 Временные характеристики этапов

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ВРЕМЕННЫЕ ХАРАКТЕРИСТИКИ                             │
└─────────────────────────────────────────────────────────────────────────────────┘

Этап 1: Анализ первой страницы     ████████████████████████████████████████ 15-30 сек
Этап 2: Определение релевантных НТД ████████████████████████████████████████ 5-10 сек
Этап 3: Проверка соответствия нормам ████████████████████████████████████████ 60-120 сек
Этап 4: Проверка по А9.2.МТН.03    ████████████████████████████████████████ 30-60 сек
Этап 5: Анализ разделов документа  ████████████████████████████████████████ 20-40 сек
Этап 6: Проверка по чек-листу      ████████████████████████████████████████ 15-30 сек
Этап 7: Генерация итогового отчета ████████████████████████████████████████ 10-20 сек

ОБЩЕЕ ВРЕМЯ: 2.5-5 минут на документ
```

## 🎯 Критерии качества проверки

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           КРИТЕРИИ КАЧЕСТВА ПРОВЕРКИ                           │
└─────────────────────────────────────────────────────────────────────────────────┘

ТОЧНОСТЬ (Precision):
• Правильное определение нарушений: ≥ 90%
• Минимизация ложных срабатываний: ≤ 5%
• Корректная классификация по критичности: ≥ 95%

ПОЛНОТА (Recall):
• Выявление всех критических нарушений: ≥ 95%
• Покрытие всех пунктов чек-листа: 100%
• Проверка всех обязательных разделов: 100%

ПРОИЗВОДИТЕЛЬНОСТЬ:
• Время обработки документа: ≤ 5 минут
• Пропускная способность: ≥ 100 документов/день
• Использование ресурсов: ≤ 80% CPU, ≤ 8GB RAM

НАДЕЖНОСТЬ:
• Успешность обработки: ≥ 99%
• Восстановление после ошибок: ≤ 30 сек
• Консистентность результатов: ≥ 98%
```

---

**© 2024 AI-NK System. Все права защищены.**

*Данная схема представляет собой детальное описание процесса иерархической проверки документов с учетом требований А9.2.МТН.03 и интеграции с перечнем НТД и чек-листом.*
