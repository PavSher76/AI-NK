# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å

## –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –≤–∫–ª—é—á–∞—è:
- –ü–æ–ª–Ω–æ—Ç—É –∑–∞–≥—Ä—É–∑–∫–∏
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –ü–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –æ—Ç RAG-—Å–µ—Ä–≤–∏—Å–∞ –∫ –ø–∞—Ä—Å–µ—Ä—É
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ 1. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- **Document-parser**: ‚úÖ Healthy (–ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Å—Ç–∞–±–∏–ª–µ–Ω)
- **RAG-service**: ‚úÖ Healthy 
- **Rule-engine**: ‚úÖ Healthy
- **Gateway**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **Frontend**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ

### ‚úÖ 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:**
- **–§–∞–π–ª**: `–ï110-0003-8000492049-–†–î-01-02.03.011-–ê–†1.1.1_3_0_RU_IFR.pdf`
- **–†–∞–∑–º–µ—Ä**: 1.4MB (8 —Å—Ç—Ä–∞–Ω–∏—Ü)
- **–¢–∏–ø**: PDF
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: corporate

**–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏:**
```json
{
  "document_id": 24,
  "filename": "–ï110-0003-8000492049-–†–î-01-02.03.011-–ê–†1.1.1_3_0_RU_IFR.pdf",
  "file_type": "pdf",
  "file_size": 1455146,
  "pages_count": 8,
  "category": "corporate",
  "status": "processing",
  "review_deadline": "2025-08-26T20:21:40.426540",
  "document_stats": {
    "total_pages": 8,
    "vector_pages": 4,
    "scanned_pages": 4,
    "unknown_pages": 0,
    "a4_sheets_equivalent": 23.0
  },
  "message": "Document uploaded successfully. Norm control check started in background."
}
```

### ‚úÖ 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞** ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
2. **–ü–∞—Ä—Å–∏–Ω–≥ PDF** ‚Üí ‚úÖ 8 —Å—Ç—Ä–∞–Ω–∏—Ü –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
3. **–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** ‚Üí ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞
4. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** ‚Üí ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** ‚Üí ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

**–õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```
INFO:main:Processing PDF with 8 pages
INFO:main:üîç [DEBUG] DocumentParser: Page 8 processed successfully
INFO:main:üîç [DEBUG] DocumentParser: Combining results from 8 pages
INFO:main:üîç [DEBUG] DocumentParser: Combined result: 0 total findings, 0 critical, 0 warnings, 0 info
INFO:main:üîç [DEBUG] DocumentParser: Norm control check completed for document 24
INFO:main:Updated checkable document 24 status to: completed
INFO:main:üîç [DEBUG] DocumentParser: Async processing completed successfully for document 24
```

### ‚ö†Ô∏è 4. –ü—Ä–æ–±–ª–µ–º—ã –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ

**–û—à–∏–±–∫–∏ –≤ —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ–º–ø—Ç–∞:**
```
KeyError: '\n  "page_number"'
WARNING:main:üîç [DEBUG] DocumentParser: Page 1 failed: '\n  "page_number"'
WARNING:main:üîç [DEBUG] DocumentParser: Page 2 failed: '\n  "page_number"'
...
```

**–í–ª–∏—è–Ω–∏–µ:** –û—à–∏–±–∫–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã, –¥–æ–∫—É–º–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### ‚úÖ 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞ checkable_documents:**
```sql
SELECT id, original_filename, processing_status, upload_date 
FROM checkable_documents ORDER BY id DESC LIMIT 2;

 id | original_filename | processing_status | upload_date
----+------------------+-------------------+----------------------------
 24 | –ï110-0003-8000492049-–†–î-01-02.03.011-–ê–†1.1.1_3_0_RU_IFR.pdf | completed | 2025-08-24 20:20:30.124457
 23 | –ï110-0038-–£–ö–ö_24.848-–†–î-01-02.12.032-–ê–†_0_0_RU_IFC.pdf | completed | 2025-08-24 19:59:00.095466
```

**–¢–∞–±–ª–∏—Ü–∞ norm_control_results:**
```sql
SELECT id, checkable_document_id, analysis_status, total_findings, analysis_date 
FROM norm_control_results ORDER BY id DESC LIMIT 3;

 id | checkable_document_id | analysis_status | total_findings | analysis_date
----+----------------------+-----------------+----------------+----------------------------
 22 | 24 | pass | 0 | 2025-08-24 20:21:40.426787
 21 | 23 | pass | 0 | 2025-08-24 20:01:15.607454
```

### ‚úÖ 6. –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ

**API –æ—Ç–≤–µ—Ç:**
```json
{
  "document": {
    "id": 24,
    "original_filename": "–ï110-0003-8000492049-–†–î-01-02.03.011-–ê–†1.1.1_3_0_RU_IFR.pdf",
    "file_type": "pdf",
    "upload_date": "2025-08-24T20:20:30.124457",
    "review_deadline": "2025-08-26T20:21:40.419877",
    "review_status": "pending"
  },
  "norm_control_result": {
    "id": 22,
    "analysis_date": "2025-08-24T20:21:40.426787",
    "analysis_status": "pass",
    "total_findings": 0,
    "critical_findings": 0,
    "warning_findings": 0,
    "info_findings": 0
  },
  "review_reports": [
    {
      "id": 20,
      "report_date": "2025-08-24T20:21:40.435974",
      "overall_status": "pass",
      "reviewer_name": "AI System",
      "conclusion": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 8 —Å—Ç—Ä–∞–Ω–∏—Ü. –ù–∞–π–¥–µ–Ω–æ 0 –Ω–∞—Ä—É—à–µ–Ω–∏–π."
    }
  ]
}
```

### ‚ùå 7. RAG-—Å–µ—Ä–≤–∏—Å –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Checkable –¥–æ–∫—É–º–µ–Ω—Ç—ã –ù–ï –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ RAG-—Å–µ—Ä–≤–∏—Å.

**–ü—Ä–∏—á–∏–Ω–∞:** –í —Ñ—É–Ω–∫—Ü–∏–∏ `process_checkable_document_async` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤—ã–∑–æ–≤ `index_to_rag_service_async`.

**–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
async def process_checkable_document_async(document_id: int, document_content: str, filename: str):
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ...
    # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: index_to_rag_service_async(document_id, filename, inspection_result)
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å uploaded_documents:**
```python
# ‚úÖ –î–ª—è uploaded_documents –µ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:
asyncio.create_task(
    parser.index_to_rag_service_async(
        document_id=document_id,
        document_title=filename,
        inspection_result=elements
    )
)
```

### ‚úÖ 8. –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤

**–î–ª—è uploaded_documents:**
- ‚úÖ –¢–æ–∫–µ–Ω—ã –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `token_count` –≤ —Ç–∞–±–ª–∏—Ü–µ `uploaded_documents`

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```sql
SELECT id, original_filename, token_count FROM uploaded_documents ORDER BY id DESC LIMIT 3;

 id | original_filename | token_count
----+------------------+-------------
 25 | –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ù–ö –ü–¢–ò.pdf | 1138
 24 | –ì–û–°–¢ 21.508-2020... | 31952
 23 | –ì–û–°–¢ 21.507-81... | 7094
```

**–î–ª—è checkable_documents:**
- ‚ùå –ö–æ–ª–æ–Ω–∫–∞ `token_count` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚ùå –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
2. **–ü–∞—Ä—Å–∏–Ω–≥ PDF** - –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. **API endpoints** - –≤—Å–µ API —Ä–∞–±–æ—Ç–∞—é—Ç
6. **–û—Ç—á–µ—Ç—ã** - –æ—Ç—á–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è:

1. **–û—à–∏–±–∫–∏ –≤ —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ–º–ø—Ç–∞** - KeyError –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ RAG** - checkable –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤** - –¥–ª—è checkable –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞** - —É—Å—Ç—Ä–∞–Ω–∏—Ç—å KeyError
2. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤ RAG** - –¥–ª—è checkable –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
3. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤** - –¥–ª—è checkable –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –î–æ–∫—É–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –û–¥–Ω–∞–∫–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –∏ –ø–æ–ª–Ω–æ—Ç—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 7/10** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
