# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã

## –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
2. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–æ–º–ø—Ç–∞ –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ù–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ 1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–í—Å–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Å–∏—Å—Ç–µ–º–µ:** 3

**–°–ø–∏—Å–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
```sql
SELECT setting_key, setting_value, setting_description, setting_type FROM system_settings;

setting_key              | setting_value | setting_description                    | setting_type
-------------------------+---------------+----------------------------------------+-------------
enable_auto_reindex      | true          | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | boolean
max_tokens_per_request   | 16000         | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å | number
normcontrol_prompt       | –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–†–û–ú–ü–¢: –¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—é... | text
```

### ‚úÖ 2. –ù–∞–ª–∏—á–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

**–ü—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è:** ‚úÖ **–ü–†–ò–°–£–¢–°–¢–í–£–ï–¢**

**API –æ—Ç–≤–µ—Ç:**
```json
{
  "setting_key": "normcontrol_prompt",
  "setting_value": "–û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–†–û–ú–ü–¢: –¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—é –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü—Ä–æ–≤–µ–¥–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º."
}
```

**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ API

### ‚úÖ 3. –†–∞–±–æ—Ç–∞ API –Ω–∞—Å—Ç—Ä–æ–µ–∫

**GET /api/settings** - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -k -H "Authorization: Bearer test-token" https://localhost:8443/api/settings
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ 3 –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

**GET /api/settings/normcontrol_prompt** - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -k -H "Authorization: Bearer test-token" https://localhost:8443/api/settings/normcontrol_prompt
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
```

**PUT /api/settings/normcontrol_prompt** - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -k -X PUT -H "Authorization: Bearer test-token" -H "Content-Type: application/json" \
  -d '{"setting_value": "–û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–†–û–ú–ü–¢: ..."}' \
  https://localhost:8443/api/settings/normcontrol_prompt
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"status":"success","message":"Setting normcontrol_prompt updated successfully"}
```

**POST /api/settings** - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫)
```bash
curl -k -X POST -H "Authorization: Bearer test-token" -H "Content-Type: application/json" \
  -d '{"setting_key": "normcontrol_prompt", "setting_value": "...", "setting_description": "...", "setting_type": "text"}' \
  https://localhost:8443/api/settings
```

**DELETE /api/settings/normcontrol_prompt** - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -k -X DELETE -H "Authorization: Bearer test-token" https://localhost:8443/api/settings/normcontrol_prompt
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"status":"success","message":"Setting normcontrol_prompt deleted successfully"}
```

### ‚úÖ 4. –†–∞–±–æ—Ç–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–õ–æ–≥–∏ frontend –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
- ‚úÖ GET –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/settings` - 200 OK
- ‚úÖ PUT –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/settings/normcontrol_prompt` - 200 OK
- ‚úÖ DELETE –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/settings/normcontrol_prompt` - 200 OK
- ‚úÖ POST –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/settings` - 200 OK

**–õ–æ–≥–∏ document-parser –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (200 OK)
- ‚úÖ Gateway –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ document-parser

### ‚úÖ 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º:**
```bash
curl -k -X POST -H "Authorization: Bearer test-token" \
  -F "file=@TestDocs/for_check/–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ/–ê–†/–ü–ª–∞–Ω –æ—Ç–≤–µ—Ä—Å—Ç–∏–π –ø—Ä–∏–º–µ—Ä.pdf" \
  https://localhost:8443/api/upload/checkable

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "document_id": 25,
  "filename": "–ü–ª–∞–Ω –æ—Ç–≤–µ—Ä—Å—Ç–∏–π –ø—Ä–∏–º–µ—Ä.pdf",
  "file_type": "pdf",
  "file_size": 92854,
  "pages_count": 1,
  "category": "other",
  "status": "processing",
  "message": "Document uploaded successfully. Norm control check started in background."
}
```

**–õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```
INFO:main:üîç [DEBUG] DocumentParser: Starting norm control check for document 25, page 1
INFO:main:üîç [DEBUG] DocumentParser: Page content length: 3019 characters
ERROR:main:Norm control check error: '\n  "page_number"'
INFO:main:üîç [DEBUG] DocumentParser: Norm control check completed for document 25
INFO:main:Updated checkable document 25 status to: completed
```

### ‚ö†Ô∏è 6. –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ–º–ø—Ç–∞
```
KeyError: '\n  "page_number"'
```

**–ú–µ—Å—Ç–æ:** –°—Ç—Ä–æ–∫–∞ 2282 –≤ `document_parser/main.py`
```python
prompt = prompt_template.format(
    page_number=page_number,
    page_content=page_content
)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ Python –∏ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –≤ —à–∞–±–ª–æ–Ω–µ

**–í–ª–∏—è–Ω–∏–µ:** –ü—Ä–æ–º–ø—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤** - –ø—Ä–æ–º–ø—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. **API –Ω–∞—Å—Ç—Ä–æ–µ–∫** - –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–§—Ä–æ–Ω—Ç–µ–Ω–¥** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
4. **Gateway** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
5. **Document-parser** - –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –∏–∑ –ë–î

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞, —Ç—Ä–µ–±—É—é—â–∞—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

**–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞** - –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ Python –∏ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞** - –∑–∞–º–µ–Ω–∏—Ç—å –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ –Ω–∞ –¥–≤–æ–π–Ω—ã–µ –≤ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–µ
2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —à–∞–±–ª–æ–Ω–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å API, –Ω–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 8/10** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞.
