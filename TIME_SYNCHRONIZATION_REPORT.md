# Отчет о синхронизации времени в контейнерах

## Проблема

Время в контейнерах проекта было не синхронизировано с временем хоста:
- **Хост:** 08:45:19 (+03) - московское время
- **Контейнеры:** 05:45 UTC - отставание на 3 часа

Это приводило к:
- Неправильным временным меткам в логах
- Неточным данным в базах данных
- Проблемам с планировщиками задач
- Несоответствию времени в различных сервисах

## Решение

Добавлена синхронизация времени во все контейнеры проекта через:

### 1. Переменные окружения
```yaml
environment:
  - TZ=Europe/Moscow
```

### 2. Монтирование системных файлов времени
```yaml
volumes:
  - /etc/localtime:/etc/localtime:ro
  - /etc/timezone:/etc/timezone:ro
```

## Обновленные сервисы

### Базы данных
- **redis** - добавлена переменная TZ и монтирование файлов времени
- **keycloak-db** - добавлена переменная TZ и монтирование файлов времени  
- **norms-db** - добавлена переменная TZ и монтирование файлов времени
- **pgbouncer** - добавлена переменная TZ и монтирование файлов времени

### Основные сервисы
- **keycloak** - добавлена переменная TZ и монтирование файлов времени
- **ollama** - добавлена переменная TZ и монтирование файлов времени
- **vllm** - добавлена переменная TZ и монтирование файлов времени
- **gateway** - добавлена переменная TZ и монтирование файлов времени
- **frontend** - добавлена переменная TZ и монтирование файлов времени
- **document-parser** - добавлена переменная TZ и монтирование файлов времени
- **rule-engine** - добавлена переменная TZ и монтирование файлов времени
- **rag-service** - добавлена переменная TZ и монтирование файлов времени

### Мониторинг
- **qdrant** - добавлена переменная TZ и монтирование файлов времени
- **prometheus** - добавлена переменная TZ и монтирование файлов времени
- **grafana** - добавлена переменная TZ и монтирование файлов времени

## Результат

### До синхронизации:
- ❌ Хост: 08:45:19 (+03)
- ❌ Контейнеры: 05:45 UTC (отставание на 3 часа)
- ❌ Неправильные временные метки в логах
- ❌ Неточные данные в БД

### После синхронизации:
- ✅ Хост: 08:45:19 (+03)
- ✅ document-parser: Tue Aug 26 08:44:57 MSK 2025
- ✅ gateway: Tue Aug 26 08:45:01 MSK 2025
- ✅ redis: Tue Aug 26 08:45:10 MSK 2025
- ✅ norms-db: Tue Aug 26 08:45:15 AM MSK 2025
- ✅ Все контейнеры показывают московское время (MSK)
- ✅ Временные метки синхронизированы

## Технические детали

### Переменная TZ
Устанавливает часовой пояс внутри контейнера:
```bash
TZ=Europe/Moscow
```

### Монтирование системных файлов
```yaml
volumes:
  - /etc/localtime:/etc/localtime:ro  # Системное время
  - /etc/timezone:/etc/timezone:ro    # Информация о часовом поясе
```

### Преимущества данного подхода:
1. **Автоматическая синхронизация** - время обновляется автоматически при изменении на хосте
2. **Поддержка летнего/зимнего времени** - автоматический переход
3. **Единообразие** - все контейнеры используют одинаковый часовой пояс
4. **Надежность** - не зависит от внутренних настроек контейнеров

## Проверка синхронизации

### Команды для проверки:
```bash
# Время на хосте
date

# Время в контейнерах
docker exec ai-nk-document-parser-1 date
docker exec ai-nk-gateway-1 date
docker exec ai-nk-redis-1 date
docker exec ai-nk-norms-db-1 date
```

### Ожидаемый результат:
Все команды должны показывать одинаковое московское время с разницей в несколько секунд.

## Заключение

Время во всех контейнерах проекта успешно синхронизировано с временем хоста. Теперь:

- ✅ Все логи имеют правильные временные метки
- ✅ Базы данных сохраняют корректное время
- ✅ Планировщики задач работают с правильным временем
- ✅ Все сервисы используют единый часовой пояс (MSK)

**Статус:** ✅ Синхронизировано
**Дата:** 26 августа 2025
**Файл:** `docker-compose.yaml`
**Часовой пояс:** Europe/Moscow (MSK)
