# AI-NK CPU Optimized Environment Configuration
# Оптимизированная конфигурация для 11 ядер CPU

# ============================================================================
# Основные настройки
# ============================================================================
TZ=Europe/Moscow
COMPOSE_PROJECT_NAME=ai-nk

# ============================================================================
# База данных PostgreSQL
# ============================================================================
POSTGRES_DB=norms_db
POSTGRES_USER=norms_user
POSTGRES_PASSWORD=norms_password
POSTGRES_HOST=norms-db
POSTGRES_PORT=5432

# ============================================================================
# Qdrant Vector Database
# ============================================================================
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_COLLECTION=normative_documents

# ============================================================================
# Ollama LLM Configuration
# ============================================================================
OLLAMA_URL=http://host.docker.internal:11434
OLLAMA_MODEL=bge-m3
OLLAMA_NUM_CTX=16384
OLLAMA_FLASH_ATTN=1
OLLAMA_NUM_BATCH=1024
OLLAMA_NUM_THREAD=8
OLLAMA_TEMPERATURE=0.1

# ============================================================================
# VLLM Service Configuration
# ============================================================================
VLLM_MODEL_NAME=microsoft/DialoGPT-medium
VLLM_MAX_TOKENS=512
VLLM_TEMPERATURE=0.7
VLLM_TOP_P=0.9

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_PASSWORD=redispass
REDIS_HOST=redis
REDIS_PORT=6379

# ============================================================================
# Keycloak Configuration
# ============================================================================
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_PORT=8081
KEYCLOAK_CLIENT_SECRET=your-secret

# ============================================================================
# Service URLs
# ============================================================================
RAG_SERVICE_URL=http://rag-service:8003
DOCUMENT_PARSER_URL=http://document-parser:8001
RULE_ENGINE_URL=http://rule-engine:8002
CALCULATION_SERVICE_URL=http://calculation-service:8004
VLLM_SERVICE_URL=http://vllm-service:8005
OUTGOING_CONTROL_URL=http://outgoing-control-service:8006
SPELLCHECKER_SERVICE_URL=http://spellchecker-service:8007
ARCHIVE_SERVICE_URL=http://archive-service:8000
ANALOG_OBJECTS_URL=http://analog-objects-service:8009
LANGUAGETOOL_URL=http://languagetool:8010

# ============================================================================
# CPU Optimization Settings
# ============================================================================

# RAG Service - High Priority (2.5 cores)
RAG_SERVICE_CPU_CORES=2.5
RAG_SERVICE_CPU_SHARES=1024
RAG_SERVICE_MEMORY_LIMIT=6G
RAG_SERVICE_MEMORY_RESERVATION=4G

# Document Parser - High Priority (2.0 cores)
DOCUMENT_PARSER_CPU_CORES=2.0
DOCUMENT_PARSER_CPU_SHARES=1024
DOCUMENT_PARSER_MEMORY_LIMIT=2G
DOCUMENT_PARSER_MEMORY_RESERVATION=1.5G

# VLLM Service - High Priority (1.0 cores)
VLLM_SERVICE_CPU_CORES=1.0
VLLM_SERVICE_CPU_SHARES=1024
VLLM_SERVICE_MEMORY_LIMIT=2G
VLLM_SERVICE_MEMORY_RESERVATION=1G

# Rule Engine - Medium Priority (0.8 cores)
RULE_ENGINE_CPU_CORES=0.8
RULE_ENGINE_CPU_SHARES=512
RULE_ENGINE_MEMORY_LIMIT=1G
RULE_ENGINE_MEMORY_RESERVATION=512M

# Calculation Service - Medium Priority (0.8 cores)
CALCULATION_SERVICE_CPU_CORES=0.8
CALCULATION_SERVICE_CPU_SHARES=512
CALCULATION_SERVICE_MEMORY_LIMIT=2G
CALCULATION_SERVICE_MEMORY_RESERVATION=1G

# SpellChecker Service - Medium Priority (0.6 cores)
SPELLCHECKER_SERVICE_CPU_CORES=0.6
SPELLCHECKER_SERVICE_CPU_SHARES=512
SPELLCHECKER_SERVICE_MEMORY_LIMIT=2G
SPELLCHECKER_SERVICE_MEMORY_RESERVATION=1G

# Archive Service - Medium Priority (0.8 cores)
ARCHIVE_SERVICE_CPU_CORES=0.8
ARCHIVE_SERVICE_CPU_SHARES=512
ARCHIVE_SERVICE_MEMORY_LIMIT=2G
ARCHIVE_SERVICE_MEMORY_RESERVATION=1G

# PostgreSQL - Base Priority (0.6 cores)
POSTGRES_CPU_CORES=0.6
POSTGRES_CPU_SHARES=256
POSTGRES_MEMORY_LIMIT=2G
POSTGRES_MEMORY_RESERVATION=1G

# Qdrant - Base Priority (0.5 cores)
QDRANT_CPU_CORES=0.5
QDRANT_CPU_SHARES=256
QDRANT_MEMORY_LIMIT=2G
QDRANT_MEMORY_RESERVATION=1G

# Gateway - Base Priority (0.4 cores)
GATEWAY_CPU_CORES=0.4
GATEWAY_CPU_SHARES=256
GATEWAY_MEMORY_LIMIT=1G
GATEWAY_MEMORY_RESERVATION=512M

# Outgoing Control Service - Support Priority (0.3 cores)
OUTGOING_CONTROL_CPU_CORES=0.3
OUTGOING_CONTROL_CPU_SHARES=128
OUTGOING_CONTROL_MEMORY_LIMIT=512M
OUTGOING_CONTROL_MEMORY_RESERVATION=256M

# LanguageTool - Support Priority (0.3 cores)
LANGUAGETOOL_CPU_CORES=0.3
LANGUAGETOOL_CPU_SHARES=128
LANGUAGETOOL_MEMORY_LIMIT=2G
LANGUAGETOOL_MEMORY_RESERVATION=1G

# Analog Objects Service - Support Priority (0.2 cores)
ANALOG_OBJECTS_CPU_CORES=0.2
ANALOG_OBJECTS_CPU_SHARES=128
ANALOG_OBJECTS_MEMORY_LIMIT=1G
ANALOG_OBJECTS_MEMORY_RESERVATION=512M

# Redis - Support Priority (0.1 cores)
REDIS_CPU_CORES=0.1
REDIS_CPU_SHARES=64
REDIS_MEMORY_LIMIT=512M
REDIS_MEMORY_RESERVATION=128M

# Keycloak - Support Priority (0.1 cores)
KEYCLOAK_CPU_CORES=0.1
KEYCLOAK_CPU_SHARES=64
KEYCLOAK_MEMORY_LIMIT=1G
KEYCLOAK_MEMORY_RESERVATION=512M

# ============================================================================
# Performance Tuning
# ============================================================================

# Connection Pool Settings
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Cache Settings
REDIS_CACHE_TTL=3600
REDIS_MAX_CONNECTIONS=100

# Worker Threads
RAG_SERVICE_WORKERS=3
DOCUMENT_PARSER_WORKERS=2
VLLM_SERVICE_WORKERS=1

# Batch Processing
BATCH_SIZE=32
MAX_BATCH_SIZE=64
BATCH_TIMEOUT=5

# ============================================================================
# Monitoring and Logging
# ============================================================================
LOG_LEVEL=INFO
ENABLE_METRICS=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30

# ============================================================================
# Security Settings
# ============================================================================
JWT_SECRET_KEY=your-jwt-secret-key
ENCRYPTION_KEY=your-encryption-key
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# ============================================================================
# Development Settings
# ============================================================================
DEBUG=false
ENABLE_DEBUG_ENDPOINTS=false
ENABLE_SWAGGER=true
