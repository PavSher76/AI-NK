┌─────────────────────────────────────────────────────────────────────────────────┐
│                    СХЕМА ПРОВЕРКИ ОРФОГРАФИИ И ТАЙМИНГА                        │
│                        (AI-NK Outgoing Control Service)                        │
└─────────────────────────────────────────────────────────────────────────────────┘

📁 ЗАГРУЗКА ДОКУМЕНТА
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. upload_start_time = 2025-09-14T22:29:00.570993                              │
│ 2. Сохранение файла на диск                                                    │
│ 3. upload_end_time = 2025-09-14T22:29:00.574663                               │
│ ⏱️ upload_duration = 0.00367 секунд                                            │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
📄 ИЗВЛЕЧЕНИЕ ТЕКСТА
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. text_extraction_start_time = 2025-09-14T22:29:00.574676                    │
│ 2. UniversalDocumentParser.parse_document()                                    │
│    ├─ PDF: PyMuPDF + pdf2image + OCR (Tesseract)                              │
│    ├─ DOCX: python-docx                                                        │
│    └─ TXT: прямое чтение                                                       │
│ 3. Создание чанков (hierarchical_chunking)                                    │
│ 4. text_extraction_end_time = 2025-09-14T22:29:00.578864                      │
│ ⏱️ text_extraction_duration = 0.004188 секунд                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
🔍 ПРОВЕРКА ОРФОГРАФИИ (SpellChecker Service)
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. Запрос отправлен: 2025-09-14T22:29:03.592513                               │
│ 2. POST http://spellchecker-service:8007/comprehensive-check                   │
│    ├─ Данные: 18 символов                                                      │
│    └─ Тип проверки: spellcheck                                                 │
│ 3. Обработка через LanguageTool (порт 8082)                                    │
│    ├─ Проверка грамматики                                                      │
│    └─ Проверка стиля                                                           │
│ 4. Обработка через Hunspell (локально)                                         │
│    ├─ Проверка орфографии                                                      │
│    └─ Словарь русского языка                                                   │
│ 5. Ответ получен: 2025-09-14T22:29:04.716027                                  │
│    ├─ Статус: success                                                          │
│    └─ Размер ответа: 653 символа                                               │
│ ⏱️ spellcheck_duration = 1.123514 секунд                                       │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
🤖 ДВОЙНАЯ ПРОВЕРКА ЧЕРЕЗ LLM (VLLM Service)
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. Запрос отправлен: 2025-09-14T22:29:54.190885                               │
│ 2. POST http://ai-nk-vllm-1:8005/chat                                         │
│    ├─ Промпт: 3766 символов                                                    │
│    ├─ Модель: llama3.1:8b                                                      │
│    └─ Анализ найденных ошибок                                                  │
│ 3. Исключение ложных срабатываний                                              │
│    ├─ Технические термины                                                      │
│    ├─ Имена собственные                                                        │
│    ├─ Сокращения и аббревиатуры                                                │
│    └─ Английские слова в деловом контексте                                     │
│ 4. Ответ получен: 2025-09-14T22:30:21.086761                                  │
│    ├─ Размер ответа: 1459 символов                                             │
│    └─ Есть ответ: True                                                         │
│ ⏱️ llm_verification_duration = 26.895876 секунд                               │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
👨‍💼 ЭКСПЕРТНЫЙ АНАЛИЗ (VLLM Service)
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. Формирование промпта с результатами spellchecker                            │
│ 2. POST http://ai-nk-vllm-1:8005/chat                                         │
│    ├─ Полный анализ документа                                                  │
│    ├─ Проверка делового стиля                                                  │
│    ├─ Проверка корпоративной этики                                             │
│    ├─ Проверка полноты и логики                                                │
│    ├─ Проверка юридической точности                                            │
│    └─ Анализ языковых аспектов                                                 │
│ 3. Генерация детального отчета                                                 │
│ 4. Время генерации отчета: 2025-09-14T22:30:21.100355                         │
│ ⏱️ expert_analysis_duration = 0.013594 секунд                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
📊 КОНСОЛИДАЦИЯ РЕЗУЛЬТАТОВ
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. Объединение всех результатов                                                │
│ 2. Генерация финального отчета                                                 │
│ 3. Сохранение в базу данных                                                    │
│ 4. Время завершения: 2025-09-14T22:30:21.100958                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ИТОГОВЫЕ ТАЙМИНГИ                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

⏱️ ОСНОВНЫЕ ЭТАПЫ:
├─ Загрузка файла:           0.00367 секунд
├─ Извлечение текста:        0.004188 секунд
├─ Проверка орфографии:      1.123514 секунд
├─ Двойная проверка LLM:     26.895876 секунд
├─ Экспертный анализ:        0.013594 секунд
└─ ОБЩЕЕ ВРЕМЯ:              28.040832 секунд

📈 ПРОИЗВОДИТЕЛЬНОСТЬ:
├─ Скорость загрузки:        4.9 МБ/сек (18 байт за 0.00367 сек)
├─ Скорость извлечения:      4.3 КБ/сек (18 байт за 0.004188 сек)
├─ Скорость проверки:        16.0 символов/сек (18 символов за 1.123514 сек)
├─ Скорость LLM:             0.67 символов/сек (3766 символов за 26.895876 сек)
└─ Скорость анализа:         1.3 КБ/сек (1459 символов за 0.013594 сек)

🎯 РЕЗУЛЬТАТЫ ПРОВЕРКИ:
├─ Всего слов:               2
├─ Проверенных слов:         2
├─ Пропущенных слов:         0
├─ Найденных ошибок:         0
├─ Точность проверки:        100.0%
├─ Ложных срабатываний:      0
└─ ВЕРДИКТ:                  ГОТОВ К ОТПРАВКЕ

┌─────────────────────────────────────────────────────────────────────────────────┐
│                            АРХИТЕКТУРА СЕРВИСОВ                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   FRONTEND      │───▶│     GATEWAY      │───▶│ OUTGOING CONTROL│
│   (React)       │    │   (порт 8443)    │    │   (порт 8006)   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ SPELLCHECKER     │
                    │   (порт 8007)    │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐    ┌─────────────────┐
                    │   LANGUAGETOOL   │    │     HUNSPELL    │
                    │   (порт 8082)    │    │   (локально)    │
                    └──────────────────┘    └─────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │   VLLM SERVICE   │
                    │   (порт 8005)    │
                    └──────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ОПТИМИЗАЦИЯ                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

🚀 ВОЗМОЖНЫЕ УЛУЧШЕНИЯ:
├─ Параллельная обработка орфографии и грамматики
├─ Кэширование результатов для повторного использования
├─ Батчинг запросов к внешним сервисам
├─ Асинхронная обработка больших документов
├─ Предварительная фильтрация очевидных ложных срабатываний
└─ Мониторинг производительности в реальном времени

📊 МОНИТОРИНГ:
├─ Время ответа каждого сервиса
├─ Количество обработанных документов
├─ Точность проверки орфографии
├─ Количество ложных срабатываний
├─ Использование ресурсов (CPU, память)
└─ Статус здоровья всех сервисов
