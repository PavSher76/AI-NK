# –û—Ç—á–µ—Ç –æ–± –∞–Ω–∞–ª–∏–∑–µ –ª–æ–≥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

## –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

## –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

### 1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Nginx)

**–õ–æ–≥–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
```
172.217.17.123 - - [24/Aug/2025:21:09:02 +0000] "PUT /api/settings/normcontrol_prompt HTTP/1.1" 200 80
172.217.17.123 - - [24/Aug/2025:21:10:33 +0000] "PUT /api/settings/normcontrol_prompt HTTP/1.1" 200 80
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **2 —É—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –ø—Ä–æ–º–ø—Ç–∞ —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- ‚úÖ **HTTP 200 OK** - –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **–†–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ 80 –±–∞–π—Ç** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞
- ‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏:** 21:09:02 –∏ 21:10:33

### 2. Gateway (API Gateway)

**–õ–æ–≥–∏ gateway –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
```
üîç [DEBUG] Gateway: Incoming request - PUT /api/settings/normcontrol_prompt
üîç [DEBUG] Gateway: Auth middleware - PUT /api/settings/normcontrol_prompt
üîç [DEBUG] Gateway: Authorization successful for /api/settings/normcontrol_prompt
üîç [DEBUG] Gateway: API route called with path: settings/normcontrol_prompt
üîç [DEBUG] Gateway: Proxying request to http://document-parser:8001/settings/normcontrol_prompt
üîç [DEBUG] Gateway: Request method: PUT
üîç [DEBUG] Gateway: Target URL: http://document-parser:8001/settings/normcontrol_prompt
INFO:httpx:HTTP Request: PUT http://document-parser:8001/settings/normcontrol_prompt "HTTP/1.1 200 OK"
INFO: 172.18.0.13:42216 - "PUT /api/settings/normcontrol_prompt HTTP/1.0" 200 OK
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ** - —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π
- ‚úÖ **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∑–∞–ø—Ä–æ—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ document-parser
- ‚úÖ **HTTP 200 OK** - document-parser —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–ª –∑–∞–ø—Ä–æ—Å
- ‚úÖ **–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞:** Frontend ‚Üí Gateway ‚Üí Document-Parser

### 3. Document-Parser (Backend)

**–õ–æ–≥–∏ document-parser –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
```
INFO: 172.18.0.12:47926 - "PUT /settings/normcontrol_prompt HTTP/1.1" 200 OK
INFO: 172.18.0.12:40800 - "PUT /settings/normcontrol_prompt HTTP/1.1" 200 OK
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **2 —É—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **HTTP 200 OK** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **IP –∞–¥—Ä–µ—Å–∞:** 172.18.0.12 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP gateway)

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞:**
```sql
SELECT setting_key, setting_value, setting_description, updated_at 
FROM system_settings 
WHERE setting_key = 'normcontrol_prompt';

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
setting_key: normcontrol_prompt
setting_value: [–ü–æ–ª–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ getDefaultNormcontrolPrompt()]
setting_description: "–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM –ø—Ä–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"
updated_at: 2025-08-24 21:09:15.007476
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ü—Ä–æ–º–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω** –≤ 21:09:15
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –≤ –∫–æ–¥–µ
- ‚úÖ **–ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç** - —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è LLM

## –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **21:09:02** - Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PUT –∑–∞–ø—Ä–æ—Å
2. **21:09:02** - Gateway –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç
3. **21:09:02** - Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ document-parser
4. **21:09:02** - Document-parser –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

### –í—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **21:10:33** - Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PUT –∑–∞–ø—Ä–æ—Å
2. **21:10:33** - Gateway –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç
3. **21:10:33** - Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ document-parser
4. **21:10:33** - Document-parser –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ API Endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **GET /api/settings** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. **PUT /api/settings/normcontrol_prompt** - –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–º–ø—Ç
3. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Bearer —Ç–æ–∫–µ–Ω–∞–º–∏
4. **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ** - gateway –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

### ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ API
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PUT –∑–∞–ø—Ä–æ—Å—ã
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 200 OK
4. **UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### ‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤** - document-parser –ø—Ä–∏–Ω–∏–º–∞–µ—Ç PUT –∑–∞–ø—Ä–æ—Å—ã
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 200 OK

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
```
Frontend (UI) ‚Üí Gateway (Auth + Proxy) ‚Üí Document-Parser (Backend) ‚Üí PostgreSQL (Database)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. ‚úÖ **2 —É—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –ø—Ä–æ–º–ø—Ç–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ –ª–æ–≥–∞—Ö
2. ‚úÖ **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç** - frontend, gateway, document-parser, –ë–î
3. ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
4. ‚úÖ **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∑–∞–ø—Ä–æ—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
5. ‚úÖ **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - –ø—Ä–æ–º–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
6. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** - —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–ò–°–¢–ï–ú–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ü–†–û–ú–ü–¢–û–í –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û**
