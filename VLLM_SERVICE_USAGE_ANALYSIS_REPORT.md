# –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è VLLM —Å–µ—Ä–≤–∏—Å–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ AI-NK

## üìã –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

VLLM —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –∫–∞–∫ **–∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è Ollama**, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ LLM –º–æ–¥–µ–ª—è–º–∏.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ VLLM —Å–µ—Ä–≤–∏—Å–∞

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ   Gateway       ‚îÇ    ‚îÇ   VLLM Adapter  ‚îÇ
‚îÇ   (React)       ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (FastAPI)     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (FastAPI)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                       ‚îÇ
                                ‚ñº                       ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   Nginx         ‚îÇ    ‚îÇ   Ollama        ‚îÇ
                       ‚îÇ   (Frontend)    ‚îÇ    ‚îÇ   (LLM Model)   ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ Docker Compose
```yaml
# vLLM –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è Ollama
vllm:
  build: ./ollama_adapter
  ports:
    - "8000:8000"
  environment:
    - OLLAMA_BASE_URL=http://ollama:11434
    - OLLAMA_MODEL=llama3.1:8b
  depends_on:
    - ollama
  restart: unless-stopped
```

## üîÑ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### 1. –ß–µ—Ä–µ–∑ Gateway (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å)
```
Frontend ‚Üí Gateway (/v1/*) ‚Üí VLLM Adapter ‚Üí Ollama
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Gateway:**
```python
# gateway/app.py
SERVICES = {
    "vllm": "http://vllm:8000"
}

@app.api_route("/v1/{path:path}", methods=["GET", "POST", "PUT", "DELETE", "PATCH"])
async def proxy_vllm(request: Request, path: str):
    """–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ VLLM"""
    service_url = SERVICES["vllm"]
    return await proxy_request(request, service_url, f"/api/{path}")
```

### 2. –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Nginx
```
Frontend ‚Üí Nginx (/v1/*) ‚Üí VLLM Adapter ‚Üí Ollama
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx:**
```nginx
# frontend/nginx-simple.conf
location /v1/ {
    proxy_pass http://vllm:8000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;
    proxy_buffering off;
}
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

### 1. Rule Engine
**–§–∞–π–ª:** `rule_engine/main.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM —á–µ—Ä–µ–∑ Gateway
response = await client.post(
    f"{GATEWAY_URL}/v1/chat/completions",
    headers={"Authorization": f"Bearer {auth_token}"},
    json={
        "model": "llama3:8b",
        "messages": [
            {
                "role": "system",
                "content": "–í—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤..."
            },
            {
                "role": "user",
                "content": prompt
            }
        ],
        "temperature": 0.3,
        "max_tokens": 2000
    }
)
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **GATEWAY_URL:** `https://gateway:8443`
- **–ú–æ–¥–µ–ª—å:** `llama3:8b`
- **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:** 0.3
- **–ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤:** 2000

### 2. Document Parser (–Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å)
**–§–∞–π–ª:** `document_parser/services/norm_control_service.py`

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢ VLLM**
- –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞
- LLM –∞–Ω–∞–ª–∏–∑ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 3. RAG Service (–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏)
**–§–∞–π–ª:** `rag_service/ntd_consultation.py`

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢ VLLM**
- –ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ Ollama API
- –û–±—Ö–æ–¥–∏—Ç VLLM –∞–¥–∞–ø—Ç–µ—Ä

## üîß VLLM Adapter API

### 1. –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints

#### `/v1/models`
```bash
GET http://localhost:8000/v1/models
```
**–û—Ç–≤–µ—Ç:**
```json
{
  "object": "list",
  "data": [
    {
      "id": "llama3.1:8b",
      "object": "model",
      "created": 1677610602,
      "owned_by": "ollama"
    }
  ]
}
```

#### `/v1/chat/completions`
```bash
POST http://localhost:8000/v1/chat/completions
```
**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "model": "llama3.1:8b",
  "messages": [
    {"role": "user", "content": "Hello"}
  ],
  "temperature": 0.7
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "chatcmpl-316266",
  "object": "chat.completion",
  "created": 28330,
  "model": "llama3.1:8b",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "Hello! How are you today?"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 3,
    "completion_tokens": 19,
    "total_tokens": 22
  }
}
```

#### `/v1/completions`
```bash
POST http://localhost:8000/v1/completions
```
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Ollama —Ñ–æ—Ä–º–∞—Ç

### 2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏
- `llama3.1:8b` (–æ—Å–Ω–æ–≤–Ω–∞—è)
- `llama3.1-optimized:latest`
- `llama3.1-optimized-v2:latest`

## üìä –°—Ç–∞—Ç—É—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
1. **Rule Engine** - –∞–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
2. **Gateway –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
3. **Nginx –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ VLLM

### ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
1. **Document Parser** - –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–ª—É—à–∫–∏
2. **RAG Service** - –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –æ–±—Ö–æ–¥—è—Ç VLLM

### üîÑ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
1. **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VLLM
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤** - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VLLM
3. **–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VLLM

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 1. –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```yaml
deploy:
  resources:
    limits:
      memory: 1G
      cpus: '1.0'
    reservations:
      memory: 512M
      cpus: '0.5'
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
- **MacBook Pro:** 2G RAM, 1 CPU
- **M3 Pro:** 2G RAM, 1 CPU  
- **70B –º–æ–¥–µ–ª—å:** 4G RAM, 2 CPU

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –õ–æ–≥–∏ VLLM Adapter
```bash
docker logs ai-nk-vllm-1
```

### 2. Health Check
```bash
curl http://localhost:8000/health
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π
```bash
curl http://localhost:8000/v1/models
```

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **Document Parser:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å LLM –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ VLLM
- **RAG Service:** –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VLLM –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ Ollama
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å VLLM

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å batch processing

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –î–æ–±–∞–≤–∏—Ç—å rate limiting
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:** 1 –∏–∑ 4 (Rule Engine)
- **–ú–æ–¥–µ–ª–∏:** 3 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–∏
- **–ü–æ—Ä—Ç—ã:** 8000 (VLLM), 11434 (Ollama)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

VLLM —Å–µ—Ä–≤–∏—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ AI-NK –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä** –¥–ª—è Ollama, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API. –û–¥–Ω–∞–∫–æ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ —Ç–æ–ª—å–∫–æ Rule Engine**, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –ª–∏–±–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç LLM, –ª–∏–±–æ –æ–±—Ö–æ–¥—è—Ç VLLM –∞–¥–∞–ø—Ç–µ—Ä.

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:**
1. ‚úÖ VLLM —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
2. ‚úÖ API —Å–æ–≤–º–µ—Å—Ç–∏–º —Å OpenAI
3. ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ
4. üîÑ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è VLLM –≤ Document Parser
2. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM –≤ –ø—Ä–æ–µ–∫—Ç–µ
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
