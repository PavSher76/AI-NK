# üöÄ CPU Optimization Summary

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ `docker-compose.yaml`
- –í—ã—è–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ CPU –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (RAG –∏ Document Parser)

### 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **11 —è–¥–µ—Ä CPU** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç RAG –∏ Parser** —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–±–µ—Å–ø–µ—á–µ–Ω
- **CPU Shares** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è macOS —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CPU Shares
- **RAG Service**: 1024 shares (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **Document Parser**: 1024 shares (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **VLLM Service**: 512 shares (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **Rule Engine**: 512 shares (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **Calculation Service**: 512 shares (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **PostgreSQL**: 256 shares (–±–∞–∑–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **Qdrant**: 256 shares (–±–∞–∑–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **Gateway**: 256 shares (–±–∞–∑–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**: `monitor_cpu_distribution.sh`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: `watch -n 30 ./monitor_cpu_distribution.sh`
- **–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç**: `CPU_DISTRIBUTION_REPORT.md`

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ CPU:
```
üî• –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (1024 shares):
   - RAG Service: 2.5 cores (reservation)
   - Document Parser: 2.5 cores (reservation)

üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (512 shares):
   - VLLM Service: 0.5 cores (reservation)
   - Rule Engine: 0.5 cores (reservation)
   - Calculation Service: 0.5 cores (reservation)

üü¢ –ë–ê–ó–û–í–´–ô –ü–†–ò–û–†–ò–¢–ï–¢ (256 shares):
   - PostgreSQL: 0.5 cores (reservation)
   - Qdrant: 0.5 cores (reservation)
   - Gateway: 0.2 cores (reservation)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **RAG –∏ Parser** –ø–æ–ª—É—á–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö 11 —è–¥–µ—Ä
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –∏ –≥–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU:
```bash
# –†–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./monitor_cpu_distribution.sh

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
watch -n 30 ./monitor_cpu_distribution.sh

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Docker
docker stats
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
docker-compose down && docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã —Å –Ω–æ–≤—ã–º–∏ CPU shares:
- **RAG Service**: 1024 shares ‚úÖ
- **Document Parser**: 1024 shares ‚úÖ
- **VLLM Service**: 512 shares ‚úÖ
- **Rule Engine**: 512 shares ‚úÖ
- **Calculation Service**: 512 shares ‚úÖ
- **PostgreSQL**: 256 shares ‚úÖ
- **Qdrant**: 256 shares ‚úÖ
- **Gateway**: 256 shares ‚úÖ

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

CPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø** RAG –∏ Parser —Å–µ—Ä–≤–∏—Å–æ–≤ –∫ CPU
- **–°—Ç–∞–±–∏–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** —Ä–µ—Å—É—Ä—Å–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º CPU —Ä–µ—Å—É—Ä—Å–æ–≤!
