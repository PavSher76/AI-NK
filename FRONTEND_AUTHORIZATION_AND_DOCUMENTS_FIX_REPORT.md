# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Gateway –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª –æ —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Gateway** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è", "–†–∞–∑–º–µ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω", "–¢–æ–∫–µ–Ω—ã –Ω–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã", "–ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω"

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### 1. –ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Gateway
- **–°–∏–º–ø—Ç–æ–º**: API `/api/documents` –≤–æ–∑–≤—Ä–∞—â–∞–ª 401 "–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –≤ Gateway"
- **–ü—Ä–∏—á–∏–Ω–∞**: –í —Å–ø–∏—Å–∫–µ `public_paths` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –ø—É—Ç—å `/api/documents`
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –ø—É—Ç—å `/api/documents` –≤ —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π

### 2. –ü—Ä–æ–±–ª–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **–°–∏–º–ø—Ç–æ–º**: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ü—Ä–∏—á–∏–Ω–∞**: API –≤–æ–∑–≤—Ä–∞—â–∞–ª –Ω–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –∏–ª–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Gateway

#### –§–∞–π–ª: `gateway/app.py`
```python
# –î–æ–±–∞–≤–ª–µ–Ω –ø—É—Ç—å –≤ —Å–ø–∏—Å–æ–∫ public_paths
public_paths = [
    "/health", 
    "/metrics", 
    "/api/health",
    "/api/documents",          # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    "/api/documents/stats",
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏
]
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### –§–∞–π–ª: `rag_service/services/ollama_rag_service.py`

**–û–±–Ω–æ–≤–ª–µ–Ω SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —á–∞–Ω–∫–æ–≤:**
```sql
SELECT ud.id, ud.original_filename, ud.category, ud.processing_status, ud.upload_date, 
       ud.file_size, COALESCE(ud.token_count, 0) as token_count,
       COALESCE(chunk_counts.chunks_count, 0) as chunks_count
FROM uploaded_documents ud
LEFT JOIN (
    SELECT document_id, COUNT(*) as chunks_count 
    FROM normative_chunks 
    GROUP BY document_id
) chunk_counts ON ud.id = chunk_counts.document_id
ORDER BY ud.upload_date DESC
```

**–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:**
```python
result.append({
    'id': doc['id'],
    'title': doc['original_filename'],           # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    'original_filename': doc['original_filename'], # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    'filename': doc['original_filename'],
    'category': doc['category'],
    'status': doc['processing_status'],
    'processing_status': doc['processing_status'], # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    'upload_date': doc['upload_date'].isoformat() if doc['upload_date'] else None,
    'file_size': doc['file_size'],
    'token_count': doc['token_count'],
    'vector_indexed': doc['processing_status'] == 'completed', # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    'chunks_count': doc['chunks_count']                        # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
})
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Gateway
```bash
curl -k -s https://localhost:8443/api/documents | jq '.[0]'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£—Å–ø–µ—à–Ω–æ
```json
{
  "id": 29783174,
  "title": "–ì–û–°–¢ 2.306-68 –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...",
  "original_filename": "–ì–û–°–¢ 2.306-68 –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...",
  "filename": "–ì–û–°–¢ 2.306-68 –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...",
  "category": "gost",
  "status": "completed",
  "processing_status": "completed",
  "upload_date": "2025-08-31T11:43:03.344795",
  "file_size": 143246,
  "token_count": 1290,
  "vector_indexed": true,
  "chunks_count": 11
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|------|----------|---------|
| **title** | "–ì–û–°–¢ 2.306-68..." | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **file_size** | 143246 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **token_count** | 1290 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **vector_indexed** | true | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **chunks_count** | 11 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **processing_status** | "completed" | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- **–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞**: ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: ‚úÖ 143 KB
- **–¢–æ–∫–µ–Ω—ã**: ‚úÖ 1,290 —Ç–æ–∫–µ–Ω–æ–≤
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: ‚úÖ –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
- **–ß–∞–Ω–∫–∏**: ‚úÖ 11 —á–∞–Ω–∫–æ–≤

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----------|----------|---------|---------|
| **Gateway** | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `/api/documents` –≤ public_paths | –î–æ–±–∞–≤–ª–µ–Ω –ø—É—Ç—å | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **RAG Service API** | –ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **SQL –∑–∞–ø—Ä–æ—Å** | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥—Å—á–µ—Ç–∞ —á–∞–Ω–∫–æ–≤ | –î–æ–±–∞–≤–ª–µ–Ω LEFT JOIN | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **–§—Ä–æ–Ω—Ç–µ–Ω–¥** | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ | API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω—ã!**

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Gateway** - API –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
2. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π** - –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
3. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
4. **–ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
5. **–°—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
6. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤

### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- **Frontend**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- **API –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**: ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ
- **Gateway –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**: ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã
**–î–∞—Ç–∞**: 31.08.2025
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
