# –û—Ç—á–µ—Ç –æ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## üö® –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
- **pgbouncer** - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è —Å –æ—à–∏–±–∫–æ–π "Setup pgbouncer config error! You must set DB_HOST env"
- **rag-service** - –Ω–µ –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ pgbouncer
- **rule-engine** - –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **document-parser** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–ª–∏—Å—å

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å API**
- Endpoint `/api/upload/normative` –Ω–µ –Ω–∞–π–¥–µ–Ω (404 Not Found)
- Endpoint `/api/norms` –Ω–µ –Ω–∞–π–¥–µ–Ω (404 Not Found)
- Endpoint `/api/stats` –Ω–µ –Ω–∞–π–¥–µ–Ω (404 Not Found)

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

#### –ü—Ä–æ–±–ª–µ–º–∞ —Å pgbouncer:
```
Create pgbouncer config in /etc/pgbouncer
/entrypoint.sh: line 66: DB_HOST: Setup pgbouncer config error! You must set DB_HOST env
```

#### –†–µ—à–µ–Ω–∏–µ:
- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏–ª–∏ pgbouncer
- –ù–∞—Å—Ç—Ä–æ–∏–ª–∏ rag-service –∏ rule-engine –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ norms-db
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `docker-compose.yaml`:

```yaml
# RAG Service - –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ norms-db
rag-service:
  environment:
    - POSTGRES_URL=postgresql://${POSTGRES_USER:-norms_user}:${POSTGRES_PASSWORD:-norms_password}@norms-db:5432/${POSTGRES_DB:-norms_db}
  depends_on:
    - norms-db  # –ò–∑–º–µ–Ω–µ–Ω–æ —Å pgbouncer –Ω–∞ norms-db

# Rule Engine - –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ norms-db
rule-engine:
  environment:
    - POSTGRES_HOST=norms-db  # –ò–∑–º–µ–Ω–µ–Ω–æ —Å pgbouncer
    - POSTGRES_PORT=5432      # –ò–∑–º–µ–Ω–µ–Ω–æ —Å 5433
  depends_on:
    - norms-db  # –ò–∑–º–µ–Ω–µ–Ω–æ —Å pgbouncer –Ω–∞ norms-db
```

### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose stop rag-service rule-engine
docker-compose rm -f rag-service rule-engine

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ rule-engine
docker rm -f ai-nk-rule-engine-1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker-compose up -d rag-service rule-engine

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ document-parser –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
docker-compose restart document-parser
```

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API endpoints**

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoints –¥–ª—è –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
- ‚úÖ `/api/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `/api/documents` - —Å–ø–∏—Å–æ–∫ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `/api/rag/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RAG service

#### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoints (404):
- ‚ùå `/api/upload/normative` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå `/api/norms` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå `/api/stats` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–£—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

#### 1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
```
INFO:main:‚úÖ [CONNECT] Connected to PostgreSQL
INFO:main:‚úÖ [CONNECT] Connected to Qdrant
```

#### 2. **API –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**
```bash
# –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
curl -k -H "Authorization: Bearer test-token" "https://localhost/api/documents"
{
  "documents": [
    {
      "id": 15,
      "original_filename": "–ì–û–°–¢ 2.306-68 –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ï–°–ö–î). –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ..._–¢–µ–∫—Å—Ç.pdf",
      "file_type": "pdf",
      "file_size": 143246,
      "status": "processing"
    },
    // ... –¥—Ä—É–≥–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
  ]
}
```

#### 3. **–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**
```bash
# –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
curl -k -X POST "https://localhost/api/upload" \
  -H "Authorization: Bearer test-token" \
  -F "file=@TestDocs/Norms/–ì–û–°–¢ 2.306-68.pdf" \
  -F "category=gost"

# –û—Ç–≤–µ—Ç
{
  "document_id": 15,
  "filename": "–ì–û–°–¢ 2.306-68 –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ï–°–ö–î). –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ..._–¢–µ–∫—Å—Ç.pdf",
  "file_type": "pdf",
  "file_size": 143246,
  "status": "processing",
  "message": "Document uploaded successfully. Processing started in background."
}
```

### üìà **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- **–í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**: 3 (–±—ã–ª–æ 2)
- **–°—Ç–∞—Ç—É—Å rag-service**: Up (health: starting)
- **–°—Ç–∞—Ç—É—Å rule-engine**: Up (health: starting)
- **–°—Ç–∞—Ç—É—Å document-parser**: Up (unhealthy, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### 1. **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ pgbouncer**
- Pgbouncer –Ω–µ –º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å—Å—è –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ norms-db
- –≠—Ç–æ —Ä–µ—à–∏–ª–æ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º rag-service –∏ rule-engine

### 2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ API endpoints**
- –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/upload`
- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/documents`
- –î–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/rag/stats`

### 3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç**
- –î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Å—Ç–∞—Ç—É—Å–æ–º "processing"
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- RAG service –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ pgbouncer**
- –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –í–µ—Ä–Ω—É—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pgbouncer –¥–ª—è connection pooling

### 2. **–£–ª—É—á—à–µ–Ω–∏–µ health checks**
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å "unhealthy" —É document-parser
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è RAG service**
- –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–∏—Å–∫–∞

## üìà –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ API –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å:**
- –°–ø–∏—Å–æ–∫ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (3 –¥–æ–∫—É–º–µ–Ω—Ç–∞)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏! üöÄ
