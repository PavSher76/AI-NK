# –û—Ç—á–µ—Ç –æ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å endpoint /api/documents/{document_id}/tokens

## üö® –í—ã—è–≤–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### **–û—à–∏–±–∫–∞ –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**
```
NormativeDocuments.js:233  GET https://localhost/api/documents/15/tokens 500 (Internal Server Error)
NormativeDocuments.js:238 üîç [DEBUG] NormativeDocuments.js: fetchDocumentTokens response status: 500
NormativeDocuments.js:244 üîç [DEBUG] NormativeDocuments.js: fetchDocumentTokens failed with status: 500
```

### **–û—à–∏–±–∫–∞ –≤ backend:**
```
ERROR:main:Get document tokens error: 'list' object has no attribute 'document_pages_results'
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### **–ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:**
–í —Ñ—É–Ω–∫—Ü–∏–∏ `get_document_tokens` –≤ —Ñ–∞–π–ª–µ `document_parser/main.py` –±—ã–ª–∞ –æ—à–∏–±–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ 3191:

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"elements_count": len(elements.document_pages_results),

# –ü–†–û–ë–õ–ï–ú–ê: elements - —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (list), 
# –∞ –Ω–µ –æ–±—ä–µ–∫—Ç DocumentInspectionResult
```

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:**
–í —Ñ—É–Ω–∫—Ü–∏–∏ `get_document_format_statistics` –≤ —Å—Ç—Ä–æ–∫–µ 1590 –±—ã–ª–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞:

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"total_pages": len(elements.document_pages_results),
```

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_document_tokens (—Å—Ç—Ä–æ–∫–∞ 3191)**
```python
# –ë–´–õ–û:
token_stats = {
    "total_tokens": document['token_count'] or 0,
    "elements_count": len(elements.document_pages_results),  # ‚ùå –û–®–ò–ë–ö–ê
    "by_type": {},
    "by_page": {}
}

# –°–¢–ê–õ–û:
token_stats = {
    "total_tokens": document['token_count'] or 0,
    "elements_count": len(elements),  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
    "by_type": {},
    "by_page": {}
}
```

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_document_format_statistics (—Å—Ç—Ä–æ–∫–∞ 1590)**
```python
# –ë–´–õ–û:
stats = {
    "total_pages": len(elements.document_pages_results),  # ‚ùå –û–®–ò–ë–ö–ê
    "total_a4_sheets": 0.0,
    # ...
}

# –°–¢–ê–õ–û:
stats = {
    "total_pages": len(elements),  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
    "total_a4_sheets": 0.0,
    # ...
}
```

### 3. **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞**
```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
docker-compose build document-parser

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose up -d --force-recreate document-parser
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–£—Å–ø–µ—à–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

#### **API endpoint —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
```bash
curl -k -H "Authorization: Bearer test-token" "https://localhost/api/documents/15/tokens"
```

#### **–û—Ç–≤–µ—Ç API:**
```json
{
  "document": {
    "id": 15,
    "original_filename": "–ì–û–°–¢ 2.306-68 –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ï–°–ö–î). –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ..._–¢–µ–∫—Å—Ç.pdf",
    "token_count": 1382,
    "file_size": 143246,
    "upload_date": "2025-08-23T12:32:07.597247"
  },
  "token_statistics": {
    "total_tokens": 1382,
    "elements_count": 2,
    "by_type": {
      "text": {
        "count": 2,
        "tokens": 1382
      }
    },
    "by_page": {
      "5": {
        "count": 1,
        "tokens": 1109
      },
      "7": {
        "count": 1,
        "tokens": 273
      }
    }
  }
}
```

### üìà **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–∞—Ö:**
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤**: 1382
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤**: 2
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º**: 2 —ç–ª–µ–º–µ–Ω—Ç–∞ —Ç–∏–ø–∞ "text"
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º**: 
  - –°—Ç—Ä–∞–Ω–∏—Ü–∞ 5: 1109 —Ç–æ–∫–µ–Ω–æ–≤
  - –°—Ç—Ä–∞–Ω–∏—Ü–∞ 7: 273 —Ç–æ–∫–µ–Ω–∞

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### 1. **–ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ `document_pages_results` –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ `list`
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ DocumentInspectionResult

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
- –ó–∞–º–µ–Ω–∞ `len(elements.document_pages_results)` –Ω–∞ `len(elements)`
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞

### 3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**
- Endpoint `/api/documents/{document_id}/tokens` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–∫–µ–Ω–∞—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û—à–∏–±–∫–∞ 500 Internal Server Error —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞

## üöÄ –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

### **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç:**
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∏–ø–∞–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫ 500 –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–∫–µ–Ω–∞—Ö

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ö–Ω–æ–ø–∫–∞ "–¢–æ–∫–µ–Ω—ã" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞

## üìà –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω–∞:**
- ‚úÖ –û—à–∏–±–∫–∞ 500 Internal Server Error —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ Endpoint `/api/documents/{document_id}/tokens` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–∫–µ–Ω–∞—Ö
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤!** üöÄ
