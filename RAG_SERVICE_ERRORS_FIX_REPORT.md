# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ RAG Service

## üìã –û–±–∑–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–í —Ö–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ RAG Service –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å–µ—Ä–≤–∏—Å–∞.

## üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –û—à–∏–±–∫–∞ DatabaseManager
**–û–ø–∏—Å–∞–Ω–∏–µ**: `'DatabaseManager' object has no attribute 'connection'`
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DatabaseManager –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
**–õ–æ–∫–∞—Ü–∏—è**: `rag_service/services/rag_service.py`, `rag_service/services/ollama_rag_service.py`, `rag_service/services/integrated_rag_service.py`

### 2. ‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–∏—Å–∞–º
**–û–ø–∏—Å–∞–Ω–∏–µ**: `Connection refused` –¥–ª—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ Ollama
**–ü—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `localhost` –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω Docker —Å–µ—Ä–≤–∏—Å–æ–≤
**–õ–æ–∫–∞—Ü–∏—è**: –†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `rag_service/`

### 3. ‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
**–û–ø–∏—Å–∞–Ω–∏–µ**: `ModuleNotFoundError: No module named 'chat_service'`
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∞–π–ª main –≤ Dockerfile
**–õ–æ–∫–∞—Ü–∏—è**: `rag_service/Dockerfile`

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DatabaseManager

#### –ü—Ä–æ–±–ª–µ–º–∞
–í —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö DatabaseManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É:
- –í `db_utils.py`: `DatabaseManager()` (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- –í —Å–µ—Ä–≤–∏—Å–∞—Ö: `DatabaseManager(self.POSTGRES_URL)` (—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º)

#### –†–µ—à–µ–Ω–∏–µ
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é DatabaseManager –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö:

```python
# –ë—ã–ª–æ
self.db_manager = DatabaseManager(self.POSTGRES_URL)

# –°—Ç–∞–ª–æ
self.db_manager = DatabaseManager()
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `rag_service/services/rag_service.py`
- `rag_service/services/ollama_rag_service.py`
- `rag_service/services/integrated_rag_service.py`

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ —Å–µ—Ä–≤–∏—Å–∞–º

#### –ü—Ä–æ–±–ª–µ–º–∞
–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å `localhost` URL, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Docker —Å–µ—Ç–∏.

#### –†–µ—à–µ–Ω–∏–µ
–ó–∞–º–µ–Ω–∏–ª `localhost` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ Docker —Å–µ—Ä–≤–∏—Å–æ–≤:

```python
# –ë—ã–ª–æ
self.QDRANT_URL = "http://localhost:6333"
self.POSTGRES_URL = "postgresql://norms_user:norms_password@localhost:5432/norms_db"
ollama_url = "http://localhost:11434"

# –°—Ç–∞–ª–æ
self.QDRANT_URL = "http://qdrant:6333"
self.POSTGRES_URL = "postgresql://norms_user:norms_password@norms-db:5432/norms_db"
ollama_url = "http://host.docker.internal:11434"
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `rag_service/services/ollama_rag_service.py`
- `rag_service/ollama_main.py`

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Dockerfile

#### –ü—Ä–æ–±–ª–µ–º–∞
Dockerfile –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∞–π–ª main, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º –∏–º–ø–æ—Ä—Ç–∞.

#### –†–µ—à–µ–Ω–∏–µ
–ò–∑–º–µ–Ω–∏–ª –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ –≤ Dockerfile:

```dockerfile
# –ë—ã–ª–æ
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8003", "--workers", "1"]

# –°—Ç–∞–ª–æ
CMD ["uvicorn", "ollama_main:app", "--host", "0.0.0.0", "--port", "8003", "--workers", "1"]
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª**:
- `rag_service/Dockerfile`

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker-compose build rag-service
docker-compose up -d rag-service
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –ª–æ–≥–∏:
```bash
docker logs ai-nk-rag-service-1 --tail 30
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ Health Check
```bash
curl -s http://localhost:8003/health
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"healthy","services":{"ollama":"healthy","qdrant":"healthy","postgresql":"healthy"}}
```

### ‚úÖ Documents Endpoint
```bash
curl -s http://localhost:8003/documents
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (8 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
```

### ‚ö†Ô∏è Stats Endpoint
```bash
curl -s http://localhost:8003/stats
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Qdrant API (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
```

## üöÄ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **Health Check**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Qdrant**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Ollama**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

### ‚ö†Ô∏è –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **Qdrant API –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ stats endpoint (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
2. **–õ–æ–≥–∏**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ deprecated —Ñ—É–Ω–∫—Ü–∏—è—Ö (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

## üìà –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚ùå –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è
- ‚ùå –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –û—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ DatabaseManager
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ DatabaseManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ RAG Service –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –°–µ—Ä–≤–∏—Å —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

- ‚úÖ Health monitoring
- ‚úÖ Document management
- ‚úÖ Database connectivity
- ‚úÖ Vector search (Qdrant)
- ‚úÖ Embedding generation (Ollama)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
**–î–∞—Ç–∞**: 31.08.2025
**–í–µ—Ä—Å–∏—è**: 2.0
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
