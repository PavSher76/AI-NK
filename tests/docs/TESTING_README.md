# Комплексное тестирование AI-NK

Этот набор скриптов обеспечивает полное тестирование всех функциональных модулей проекта AI-NK.

## Структура тестирования

### Основные скрипты

1. **`run_comprehensive_tests.py`** - Главный скрипт для запуска всех тестов
2. **`test_comprehensive_suite.py`** - Базовый класс для комплексного тестирования
3. **`test_chat_ai_module.py`** - Тестирование модуля "Чат с ИИ"
4. **`test_outgoing_control_module.py`** - Тестирование модуля "Выходной контроль корреспонденции"
5. **`test_ntd_consultation_module.py`** - Тестирование модуля "Консультация НТД от ИИ"
6. **`test_calculations_module.py`** - Тестирование модуля "Расчеты"

### Модули тестирования

#### 1. Чат с ИИ (`test_chat_ai_module.py`)
- ✅ Проверка здоровья сервиса
- ✅ Загрузка и анализ PDF документов
- ✅ Загрузка и анализ DOCX документов
- ✅ Чат с контекстом документа
- ✅ Чат без контекста
- ✅ Полный пайплайн обработки документа
- ✅ Обработка ошибок

#### 2. Выходной контроль корреспонденции (`test_outgoing_control_module.py`)
- ✅ Проверка здоровья сервиса
- ✅ Обработка PDF документов
- ✅ Обработка DOCX документов
- ✅ Проверка орфографии
- ✅ Анализ документа
- ✅ Генерация отчета
- ✅ Пакетная обработка
- ✅ Контроль качества
- ✅ Обработка ошибок

#### 3. Консультация НТД от ИИ (`test_ntd_consultation_module.py`)
- ✅ Проверка здоровья сервиса
- ✅ Функциональность поиска
- ✅ Обработка LLM
- ✅ Ссылки на документы
- ✅ Качество ответов
- ✅ Контекстная осведомленность
- ✅ Многоязычная поддержка
- ✅ Интеграция с базой знаний
- ✅ Обработка ошибок

#### 4. Расчеты (`test_calculations_module.py`)
- ✅ Проверка здоровья сервиса
- ✅ Расчет прочности сварных соединений
- ✅ Расчет свойств материалов
- ✅ Расчет коэффициентов безопасности
- ✅ Расчет допусков и посадок
- ✅ Расчет теплового расширения
- ✅ Расчет усталостного анализа
- ✅ Пакетные расчеты
- ✅ Фронтенд расчеты
- ✅ Точность расчетов
- ✅ Обработка ошибок

## Запуск тестирования

### Быстрый запуск всех тестов
```bash
python run_comprehensive_tests.py
```

### Запуск отдельных модулей
```bash
# Тестирование чата с ИИ
python test_chat_ai_module.py

# Тестирование выходного контроля
python test_outgoing_control_module.py

# Тестирование консультации НТД
python test_ntd_consultation_module.py

# Тестирование расчетов
python test_calculations_module.py
```

### Запуск базового тестирования
```bash
python test_comprehensive_suite.py
```

## Требования

### Системные требования
- Python 3.8+
- aiohttp
- asyncio
- json
- logging

### Зависимости
```bash
pip install aiohttp
```

### Сервисы проекта
Перед запуском тестов убедитесь, что все сервисы проекта запущены:
- VLLM Service (порт 8005)
- Outgoing Control Service (порт 8006)
- RAG Service (порт 8003)
- Calculation Service (порт 8004)
- Spellchecker Service (порт 8007)
- Document Parser (порт 8001)
- Rule Engine (порт 8002)
- Frontend (порт 443)

## Тестовые данные

### Документы для тестирования
Тесты используют документы из папки `TestDocs/for_check/`:
- `test_document.pdf` - PDF документ для тестирования
- `test_document.docx` - DOCX документ для тестирования
- `gost_document.pdf` - ГОСТ документ для тестирования

### Параметры расчетов
Тесты используют следующие параметры для расчетов:

#### Прочность сварных соединений
- Материал: сталь
- Толщина: 10 мм
- Тип шва: стыковой
- Нагрузка: 1000 Н

#### Свойства материалов
- Материал: алюминий
- Температура: 20°C
- Напряжение: 100 МПа

#### Коэффициенты безопасности
- Нагрузка: 1000 Н
- Коэффициент безопасности: 2.5
- Предел текучести материала: 250 МПа

## Отчеты

После выполнения тестов генерируются следующие отчеты:

### JSON отчет
- `comprehensive_test_report.json` - Полный отчет в формате JSON
- `chat_ai_test_report.json` - Отчет по модулю чата с ИИ
- `outgoing_control_test_report.json` - Отчет по модулю выходного контроля
- `ntd_consultation_test_report.json` - Отчет по модулю консультации НТД
- `calculations_test_report.json` - Отчет по модулю расчетов

### HTML отчет
- `comprehensive_test_report.html` - Интерактивный HTML отчет

### Текстовый отчет
- `comprehensive_test_report.txt` - Текстовый отчет для консоли

### Логи
- `comprehensive_test_suite.log` - Логи выполнения тестов

## Интерпретация результатов

### Статусы тестов
- ✅ **ПРОЙДЕН** - Тест выполнен успешно
- ❌ **ПРОВАЛЕН** - Тест не прошел
- ⚠️ **ОШИБКА** - Критическая ошибка при выполнении

### Уровни успешности
- **80%+** - Отличный результат
- **60-79%** - Хороший результат
- **40-59%** - Удовлетворительный результат
- **<40%** - Требует внимания

### Коды выхода
- `0` - Все тесты пройдены успешно
- `1` - Есть проваленные тесты
- `2` - Критическая ошибка

## Устранение неполадок

### Проблемы с подключением
1. Убедитесь, что все сервисы запущены
2. Проверьте доступность портов
3. Проверьте SSL сертификаты

### Проблемы с тестовыми данными
1. Убедитесь, что папка `TestDocs/for_check/` существует
2. Проверьте наличие тестовых документов
3. Проверьте права доступа к файлам

### Проблемы с зависимостями
1. Установите все необходимые пакеты Python
2. Проверьте версию Python (требуется 3.8+)
3. Обновите pip до последней версии

## Расширение тестирования

### Добавление новых тестов
1. Создайте новый файл `test_new_module.py`
2. Наследуйте класс от базового тестера
3. Реализуйте методы тестирования
4. Добавьте модуль в `run_comprehensive_tests.py`

### Настройка параметров
1. Измените параметры в соответствующих классах тестеров
2. Обновите тестовые данные
3. Настройте ожидаемые результаты

## Поддержка

При возникновении проблем:
1. Проверьте логи в `comprehensive_test_suite.log`
2. Убедитесь, что все сервисы работают корректно
3. Проверьте конфигурацию проекта
4. Обратитесь к документации проекта AI-NK
