# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π Ollama –∏ vLLM

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ Ollama (BGE-M3) –∏ vLLM (GPT-OSS) –≤ –ø—Ä–æ–µ–∫—Ç AI-NK –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –ø—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
- **–ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–µ–π –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
- **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** - –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

## ü§ñ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. Ollama
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Ollama (https://ollama.ai/)
- –ú–æ–¥–µ–ª—å BGE-M3 –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

### 2. vLLM
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π vLLM (`pip install vllm`)
- –ú–æ–¥–µ–ª—å GPT-OSS –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

### 3. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ RAM –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
- GPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è vLLM)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama

```bash
# macOS
curl -fsSL https://ollama.ai/install.sh | sh

# Linux
curl -fsSL https://ollama.ai/install.sh | sh

# Windows
# –°–∫–∞—á–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å https://ollama.ai/download
```

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ BGE-M3

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º Ollama
ollama serve

# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å
ollama pull bge-m3
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ vLLM

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ vLLM
pip install vllm

# –î–ª—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è (CUDA)
pip install vllm[all]
```

### –®–∞–≥ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ GPT-OSS

```bash
# –°–∫–∞—á–∏–≤–∞–µ–º –º–æ–¥–µ–ª—å GPT-OSS (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–∫–∞—á–∞–Ω–∞)
# –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ Ollama
ollama pull gpt-oss:20b
```

## üîß –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

### 1. –ó–∞–ø—É—Å–∫ vLLM

```bash
# –ó–∞–ø—É—Å–∫ vLLM —Å GPT-OSS –º–æ–¥–µ–ª—å—é
./scripts/start_vllm.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
vllm serve --model gpt-oss:20b --port 8000 --host 0.0.0.0
```

### 2. –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ RAG —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ RAG —Å–µ—Ä–≤–∏—Å–∞
./scripts/start_integrated_rag.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
cd rag_service
python integrated_main.py
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
rag_service/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ ollama_rag_service.py      # RAG —Å–µ—Ä–≤–∏—Å —Å Ollama BGE-M3
‚îÇ   ‚îî‚îÄ‚îÄ integrated_rag_service.py  # –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π RAG —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ chat_service/
‚îÇ   ‚îî‚îÄ‚îÄ vllm_chat_service.py      # –°–µ—Ä–≤–∏—Å —á–∞—Ç–æ–≤ —Å vLLM GPT-OSS
‚îú‚îÄ‚îÄ ollama_main.py                 # Main –¥–ª—è Ollama RAG
‚îî‚îÄ‚îÄ integrated_main.py             # Main –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ RAG

scripts/
‚îú‚îÄ‚îÄ start_vllm.sh                  # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ vLLM
‚îî‚îÄ‚îÄ start_integrated_rag.sh        # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ RAG
```

## üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `GET /` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /metrics` - –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
- `GET /stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

### –î–æ–∫—É–º–µ–Ω—Ç—ã

- `GET /documents` - –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `GET /documents/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `GET /documents/{id}/chunks` - –ß–∞–Ω–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `DELETE /documents/{id}` - –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `DELETE /documents/{id}/indexes` - –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

### –ü–æ–∏—Å–∫ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

- `POST /search` - –ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
- `POST /ntd-consultation/chat` - –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ù–¢–î
- `GET /ntd-consultation/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- `POST /reindex` - –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Ollama

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:11434/api/tags

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏ BGE-M3
ollama list | grep bge-m3
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ vLLM

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:8000/v1/models

# –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
curl -X POST "http://localhost:8000/v1/completions" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-oss:20b",
    "prompt": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
    "max_tokens": 50
  }'
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ RAG —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8003/health

# –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞
curl -X POST "http://localhost:8003/search" \
  -F "query=–ß—Ç–æ —Ç–∞–∫–æ–µ –ì–û–°–¢?" \
  -F "k=5"

# –¢–µ—Å—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
curl -X POST "http://localhost:8003/ntd-consultation/chat" \
  -H "Content-Type: application/json" \
  -d '{"message": "–ß—Ç–æ —Ç–∞–∫–æ–µ –ì–û–°–¢?", "user_id": "test"}'
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

- **Ollama**: –õ–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `ollama serve`
- **vLLM**: –õ–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `vllm serve`
- **RAG —Å–µ—Ä–≤–∏—Å**: –õ–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `integrated_main.py`

### –ú–µ—Ç—Ä–∏–∫–∏

- **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: `http://localhost:8003/metrics`
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: `http://localhost:8003/stats`
- **–ó–¥–æ—Ä–æ–≤—å–µ**: `http://localhost:8003/health`

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: Ollama –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
ollama list

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
ollama serve
```

### –ü—Ä–æ–±–ª–µ–º–∞: vLLM –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep vllm

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
pkill -f "vllm serve"
./scripts/start_vllm.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: RAG —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
python -c "import qdrant_client, psycopg2, requests"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
curl http://localhost:6333/collections  # Qdrant
curl http://localhost:11434/api/tags    # Ollama
curl http://localhost:8000/v1/models    # vLLM
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥–µ–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π Ollama
ollama list

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π vLLM
curl http://localhost:8000/v1/models

# –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
ollama pull bge-m3
ollama pull gpt-oss:20b
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **BGE-M3**: –ú–∏–Ω–∏–º—É–º 4GB RAM
- **GPT-OSS 20B**: –ú–∏–Ω–∏–º—É–º 16GB RAM
- **Qdrant**: –ú–∏–Ω–∏–º—É–º 2GB RAM
- **PostgreSQL**: –ú–∏–Ω–∏–º—É–º 1GB RAM

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU –¥–ª—è vLLM (CUDA)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä —á–∞–Ω–∫–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤ Qdrant

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker-compose down
```

### 2. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ Qdrant –∏ PostgreSQL
docker-compose up qdrant norms-db -d

# –ó–∞–ø—É—Å–∫ vLLM
./scripts/start_vllm.sh

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ RAG
./scripts/start_integrated_rag.sh
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ Gateway –¥–ª—è RAG —Å–µ—Ä–≤–∏—Å–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS
- –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π Ollama –∏ vLLM –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Å—Ç–æ—Ç–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π, –ø–æ–∑–≤–æ–ª—è—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–µ–π –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–º–æ—â–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫:
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Ollama](https://ollama.ai/docs)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è vLLM](https://docs.vllm.ai/)
- [Issues –ø—Ä–æ–µ–∫—Ç–∞](https://github.com/your-repo/issues)
