# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –∏ –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üöÄ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ—Ç–ª–∞–¥–∫–∏

#### –ù–æ–≤—ã–µ –ª–æ–≥–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ upload_checkable_document:
```
INFO:main:üîç [DEBUG] DocumentParser: Processing mode: ASYNC
INFO:main:üîç [DEBUG] DocumentParser: Memory limit: 100MB
```

#### –ù–æ–≤—ã–µ –ª–æ–≥–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ parse_pdf:
```
INFO:main:üîç [DEBUG] DocumentParser: PDF document parameters:
INFO:main:üîç [DEBUG] DocumentParser: - Total pages: 47
INFO:main:üîç [DEBUG] DocumentParser: - File size: 14430600 bytes
INFO:main:üîç [DEBUG] DocumentParser: - Average page size: 307037 bytes
```

### 2. ‚úÖ –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```python
BATCH_SIZE = 5  # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ 5 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑
total_batches = (len(pdf_reader.pages) + BATCH_SIZE - 1) // BATCH_SIZE
```

#### –õ–æ–≥–∏ –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```
INFO:main:üîç [DEBUG] DocumentParser: Batch processing settings:
INFO:main:üîç [DEBUG] DocumentParser: - Batch size: 5 pages
INFO:main:üîç [DEBUG] DocumentParser: - Total batches: 10
INFO:main:üîç [DEBUG] DocumentParser: Starting batch 1/10 (pages 1-5)
INFO:main:üîç [DEBUG] DocumentParser: Memory usage before batch 1
```

### 3. ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü

#### –ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π:
```python
# –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
try:
    page_text = page.extract_text()
    page_size = len(page_text) if page_text else 0
    logger.info(f"üîç [DEBUG] DocumentParser: Page {page_number} parameters:")
    logger.info(f"üîç [DEBUG] DocumentParser: - Text size: {page_size} characters")
    logger.info(f"üîç [DEBUG] DocumentParser: - Has text: {bool(page_text)}")
    logger.info(f"üîç [DEBUG] DocumentParser: - Text preview: {page_text[:100] if page_text else 'No text'}...")
except Exception as e:
    logger.warning(f"üîç [DEBUG] DocumentParser: Failed to extract text from page {page_number}: {e}")
```

### 4. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### –õ–æ–≥–∏ –≤ process_checkable_document_async:
```
INFO:main:üîç [DEBUG] DocumentParser: Async processing parameters:
INFO:main:üîç [DEBUG] DocumentParser: - Document ID: 14
INFO:main:üîç [DEBUG] DocumentParser: - Document content size: 1234567 characters
INFO:main:üîç [DEBUG] DocumentParser: - Filename: document.pdf
INFO:main:üîç [DEBUG] DocumentParser: Memory usage start of async processing
```

#### –õ–æ–≥–∏ –≤ split_document_into_pages:
```
INFO:main:üîç [DEBUG] DocumentParser: Starting split_document_into_pages for document 14
INFO:main:üîç [DEBUG] DocumentParser: Split document 14 into 47 pages based on PDF structure
INFO:main:üîç [DEBUG] DocumentParser: Page details for document 14:
INFO:main:üîç [DEBUG] DocumentParser: - Page 1: 1234 chars, 15 elements
INFO:main:üîç [DEBUG] DocumentParser: - Page 1 content preview: Lorem ipsum dolor sit amet...
```

### 5. ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è

#### –õ–æ–≥–∏ –≤ perform_norm_control_check_for_page:
```
INFO:main:üîç [DEBUG] DocumentParser: Starting norm control check for document 14, page 1
INFO:main:üîç [DEBUG] DocumentParser: Page parameters:
INFO:main:üîç [DEBUG] DocumentParser: - Page number: 1
INFO:main:üîç [DEBUG] DocumentParser: - Content length: 1234 characters
INFO:main:üîç [DEBUG] DocumentParser: - Element count: 15
INFO:main:üîç [DEBUG] DocumentParser: - Content preview: Lorem ipsum dolor sit amet...
```

### 6. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏ –≤ –±–∞—Ç—á–∞—Ö

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ç—á–∞:
```python
# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞—Ç—á–∞
logger.info(f"üîç [DEBUG] DocumentParser: Completed batch {batch_num + 1}/{total_batches}")
log_memory_usage(f"after batch {batch_num + 1}")
cleanup_memory()
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:
- **–ù–æ–≤—ã–µ –ª–æ–≥–∏ –æ—Ç–ª–∞–¥–∫–∏** - —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (5 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ –±–∞—Ç—á)
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏** - —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (144.2MB RSS)

### üìà –ü—Ä–∏–º–µ—Ä –Ω–æ–≤—ã—Ö –ª–æ–≥–æ–≤:
```
INFO:main:üîç [DEBUG] DocumentParser: Processing mode: ASYNC
INFO:main:üîç [DEBUG] DocumentParser: Memory limit: 100MB
INFO:main:üîç [DEBUG] DocumentParser: PDF document parameters:
INFO:main:üîç [DEBUG] DocumentParser: - Total pages: 47
INFO:main:üîç [DEBUG] DocumentParser: - File size: 14430600 bytes
INFO:main:üîç [DEBUG] DocumentParser: - Average page size: 307037 bytes
INFO:main:üîç [DEBUG] DocumentParser: Batch processing settings:
INFO:main:üîç [DEBUG] DocumentParser: - Batch size: 5 pages
INFO:main:üîç [DEBUG] DocumentParser: - Total batches: 10
```

### ‚ö†Ô∏è –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- **Document-parser –≤—Å–µ –µ—â–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ 47-—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ PDF
- **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–∏—á–∏–Ω–∞**: –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–µ

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### 1. **–î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 2. **–ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –≥—Ä—É–ø–ø–∞–º–∏ –ø–æ 5
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö ("Processing mode: ASYNC")
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### 4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü
- –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

### 2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å checkpoint'—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –±–∞—Ç—á–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

## üìà –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏:

- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–∏–¥–∏–º –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è 47-—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ PDF (10 –±–∞—Ç—á–µ–π –ø–æ 5 —Å—Ç—Ä–∞–Ω–∏—Ü)
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏** - —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞** - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç—å—é –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤! üöÄ
