# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ Frontend –∏ —Ä–∞–±–æ—Ç—ã —Å Ollama

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: 16.10.2025 16:08
- **–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã**: –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤ Ollama

## üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. Frontend (Nginx)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Ä—Ç**: 443 (HTTPS)
- **Health Check**: ‚úÖ –£—Å–ø–µ—à–Ω–æ
- **–õ–æ–≥–∏**: –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ, –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

#### 2. Gateway
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Ä—Ç**: 8443 (HTTPS)
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Ollama**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `host.docker.internal:11434`

#### 3. Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–π)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Ä—Ç**: 11434
- **–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏**: 6 –º–æ–¥–µ–ª–µ–π
  - `llama2:latest` (7B)
  - `llama3.1:8b` (8B)
  - `gpt-oss-optimized:latest` (20.9B)
  - `gpt-oss:latest` (20.9B)
  - `bge-m3:latest` (566.70M)
  - `gpt-oss:20b` (20.9B)

#### 4. Normcontrol2 Service
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Ä—Ç**: 8010
- **API**: ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω

### ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. Calculation Service
- **–°—Ç–∞—Ç—É—Å**: ‚ùå –ù–µ –∑–∞–ø—É—â–µ–Ω
- **–û—à–∏–±–∫–∞**: `Name or service not known`
- **–í–ª–∏—è–Ω–∏–µ**: –û—à–∏–±–∫–∏ 503 –≤ frontend –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤

#### 2. –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤ Ollama
- **–ü—Ä–æ–±–ª–µ–º–∞**: Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- **–†–∞–±–æ—Ç–∞—é—â–∏–π –º–∞—Ä—à—Ä—É—Ç**: `/ollama/api/tags` ‚úÖ
- **–ù–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π –º–∞—Ä—à—Ä—É—Ç**: `/api/ollama/tags` ‚ùå

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –õ–æ–≥–∏ Frontend
```
‚úÖ Health checks: 200 OK
‚úÖ RAG requests: 200 OK
‚ùå Calculation requests: 503 Service Unavailable
```

### –õ–æ–≥–∏ Gateway
```
‚úÖ Ollama connection: –†–∞–±–æ—Ç–∞–µ—Ç
‚ùå Calculation service: Name or service not known
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Ollama
```bash
# ‚úÖ –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
curl http://localhost:11434/api/tags

# ‚úÖ –ß–µ—Ä–µ–∑ Gateway (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç)
curl -k -X GET "https://localhost:8443/ollama/api/tags" -H "Authorization: Bearer disabled-auth"

# ‚ùå –ß–µ—Ä–µ–∑ Gateway (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç)
curl -k -X GET "https://localhost:8443/api/ollama/tags"
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ Ollama
| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ |
|--------|--------|-----------|-------------|
| llama2:latest | 3.8GB | 7B | Q4_0 |
| llama3.1:8b | 4.9GB | 8B | Q4_K_M |
| gpt-oss-optimized:latest | 13.8GB | 20.9B | MXFP4 |
| gpt-oss:latest | 13.8GB | 20.9B | MXFP4 |
| bge-m3:latest | 1.2GB | 566.70M | F16 |
| gpt-oss:20b | 13.8GB | 20.9B | MXFP4 |

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
| –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ç—É—Å | –ü–æ—Ä—Ç | Health Check |
|--------|--------|------|--------------|
| frontend | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 443 | ‚úÖ |
| gateway | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 8443 | ‚úÖ |
| normcontrol2-service | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 8010 | ‚úÖ |
| norms-db | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 5432 | ‚úÖ |
| redis | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 6379 | ‚úÖ |
| calculation-service | ‚ùå –ù–µ –∑–∞–ø—É—â–µ–Ω | 8002 | ‚ùå |

## üö® –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Calculation Service –Ω–µ –∑–∞–ø—É—â–µ–Ω
- **–ü—Ä–∏—á–∏–Ω–∞**: –°–µ—Ä–≤–∏—Å –Ω–µ –≤–∫–ª—é—á–µ–Ω –≤ docker-compose
- **–í–ª–∏—è–Ω–∏–µ**: –û—à–∏–±–∫–∏ 503 –¥–ª—è –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å calculation-service

### 2. –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤ Ollama
- **–ü—Ä–æ–±–ª–µ–º–∞**: Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/ollama/`, –Ω–æ Gateway –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `/ollama/`
- **–í–ª–∏—è–Ω–∏–µ**: –û—à–∏–±–∫–∏ 404 –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö Ollama –∑–∞–ø—Ä–æ—Å–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ RAG Service
- **–ü—Ä–∏—á–∏–Ω–∞**: RAG service –Ω–µ –∑–∞–ø—É—â–µ–Ω (ReadTimeoutError –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)
- **–í–ª–∏—è–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å RAG service –æ—Ç–¥–µ–ª—å–Ω–æ

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å calculation-service**:
   ```bash
   docker-compose up calculation-service -d
   ```

2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã Ollama**:
   - –û–±–Ω–æ–≤–∏—Ç—å frontend –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `/ollama/` –≤–º–µ—Å—Ç–æ `/api/ollama/`
   - –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å Gateway –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `/api/ollama/`

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å RAG service**:
   ```bash
   docker-compose up rag-service -d
   ```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤**: –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ health checks
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º API

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- ‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ Gateway —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ Ollama —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Gateway
- ‚úÖ Normcontrol2 Service –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

**–¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è:**
- ‚ùå Calculation Service –Ω–µ –∑–∞–ø—É—â–µ–Ω
- ‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤ Ollama
- ‚ùå RAG Service –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã**: üü° –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (80% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å calculation-service –∏ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ Ollama –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
