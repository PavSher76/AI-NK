// Утилиты для работы с настройками системы

// Получение промпта для нормоконтроля по умолчанию
export const getDefaultNormcontrolPrompt = () => {
  return `Ты - эксперт по нормоконтролю в строительстве и проектировании. Твоя задача - провести комплексную проверку документа на соответствие нормативным требованиям.

ИНСТРУКЦИЯ ДЛЯ ПРОВЕРКИ:

1. АНАЛИЗ ДОКУМЕНТА:
- Изучи содержимое проверяемого документа: {document_content}
- Определи тип документа (проектная документация, чертежи, спецификации и т.д.)
- Выяви основные разделы и элементы документа

2. ПРОВЕРКА ПО НОРМАТИВНЫМ ДОКУМЕНТАМ:
- Используй следующие нормативные документы для проверки: {normative_docs}
- Проверь соответствие каждого требования нормативным документам
- Выяви нарушения и несоответствия

3. СТРУКТУРА ОТЧЕТА:
Сформируй подробный отчет в следующем формате:

## ОБЩАЯ ИНФОРМАЦИЯ
- Тип документа: [указать]
- Основные разделы: [перечислить]
- Общая оценка соответствия: [соответствует/не соответствует/частично соответствует]

## ПРОВЕРЕННЫЕ РАЗДЕЛЫ
### [Название раздела 1]
- **Статус**: [соответствует/не соответствует/требует доработки]
- **Найденные нарушения**:
  - [Описание нарушения 1]
  - [Описание нарушения 2]
- **Рекомендации по исправлению**:
  - [Рекомендация 1]
  - [Рекомендация 2]
- **Ссылки на нормативные документы**: [ГОСТ, СП, СНиП и т.д.]

### [Название раздела 2]
[аналогично для каждого раздела]

## КРИТИЧЕСКИЕ НАРУШЕНИЯ
- [Список критических нарушений, требующих обязательного исправления]

## РЕКОМЕНДАЦИИ
- [Общие рекомендации по улучшению документа]

## ЗАКЛЮЧЕНИЕ
- [Итоговая оценка и выводы]

4. КРИТЕРИИ ОЦЕНКИ:
- **Соответствует**: Документ полностью соответствует нормативным требованиям
- **Частично соответствует**: Есть незначительные нарушения, не влияющие на безопасность
- **Не соответствует**: Есть критические нарушения, требующие исправления

5. ТРЕБОВАНИЯ К ОТЧЕТУ:
- Будь максимально конкретным и точным
- Указывай конкретные пункты нормативных документов
- Предлагай конкретные решения для исправления нарушений
- Используй профессиональную терминологию
- Структурируй информацию для удобства восприятия

Начни анализ документа и сформируй отчет согласно данной инструкции.`;
};

// Получение сохраненного промпта для нормоконтроля
export const getNormcontrolPrompt = async () => {
  try {
    const response = await fetch('/api/settings/normcontrol_prompt');
    if (response.ok) {
      const data = await response.json();
      return data.setting_value || getDefaultNormcontrolPrompt();
    }
  } catch (error) {
    console.error('Ошибка получения промпта:', error);
  }
  return getDefaultNormcontrolPrompt();
};

// Сохранение промпта для нормоконтроля
export const saveNormcontrolPrompt = async (prompt) => {
  try {
    const response = await fetch('/api/settings/normcontrol_prompt', {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ setting_value: prompt })
    });
    
    if (response.ok) {
      return true;
    } else {
      console.error('Ошибка сохранения промпта:', response.status);
      return false;
    }
  } catch (error) {
    console.error('Ошибка сохранения промпта:', error);
    return false;
  }
};

// Формирование промпта с подстановкой переменных
export const formatNormcontrolPrompt = (prompt, documentContent, normativeDocs) => {
  return prompt
    .replace(/{document_content}/g, documentContent || '')
    .replace(/{normative_docs}/g, normativeDocs || '');
};
