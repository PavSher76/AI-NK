# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ API

## üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—à–µ–Ω–∏–∏

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 12 —è–Ω–≤–∞—Ä—è 2025  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~30 –º–∏–Ω—É—Ç  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –†–ï–®–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º–∞:** 404 –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API –º–æ–¥—É–ª—è "–ù–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å - 2"

## üö® –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```
normcontrol2Api.js:26 
 GET https://localhost/api/normcontrol2/documents 404 (Not Found)
normcontrol2Api.js:39 API request failed: Error: HTTP error! status: 404
normcontrol2Api.js:26 
 GET https://localhost/api/normcontrol2/settings 404 (Not Found)
normcontrol2Api.js:39 API request failed: Error: HTTP error! status: 404
normcontrol2Api.js:26 
 GET https://localhost/api/normcontrol2/statistics 404 (Not Found)
normcontrol2Api.js:39 API request failed: Error: HTTP error! status: 404
```

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–ª –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `https://localhost/api/normcontrol2/*`
- Gateway –Ω–µ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ normcontrol2-service
- API –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ 404 Not Found

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
```bash
# –ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–∏—Å—É
curl http://localhost:8010/normcontrol2/status
# ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"running","service":"normcontrol2-service","version":"1.0.0"}

# –û–±—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ gateway
curl -k https://localhost:8443/api/normcontrol2/status
# ‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç: {"detail":"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –≤ Gateway"}
```

### 2. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ gateway
```bash
docker-compose logs gateway --tail=20
# –ü–æ–∫–∞–∑–∞–ª–æ: "Unknown path, defaulting to document-parser"
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ gateway
- ‚úÖ normcontrol2-service –¥–æ–±–∞–≤–ª–µ–Ω –≤ SERVICES
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–æ—É—Ç–µ—Ä–µ
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –ø—É—Ç–∏ –≤ —Å–ø–∏—Å–∫–µ –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```python
SERVICES = {
    # ... –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã ...
    "normcontrol2-service": "http://normcontrol2-service:8010",
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã ...
}
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π
```python
public_paths = [
    # ... –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏ ...
    "/api/normcontrol2",       # –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ù–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å - 2
    "/api/normcontrol2/"       # –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ù–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å - 2 —Å —Å–ª—ç—à–µ–º
]
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ API –ø—Ä–µ—Ñ–∏–∫—Å–∞
```python
api_prefixes = [
    # ... –¥—Ä—É–≥–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã ...
    "/api/normcontrol2"
]
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä
```python
elif path.startswith("normcontrol2"):
    service_url = SERVICES["normcontrol2-service"]
    print(f"üîç [DEBUG] Gateway: Routing normcontrol2 to service: {service_url}")
    # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å api/ –µ—Å–ª–∏ –µ—Å—Ç—å, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º normcontrol2
    clean_path = path.replace("api/", "") if path.startswith("api/") else path
    return await proxy_request(request, service_url, f"/{clean_path}")
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –º–∞—Ä—à—Ä—É—Ç–∞
```python
@app.api_route("/api/normcontrol2/{path:path}", methods=["GET", "POST", "PUT", "DELETE", "PATCH"])
async def normcontrol2_proxy(path: str, request: Request):
    """–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å—É –ù–æ—Ä–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å - 2"""
    # ... –∫–æ–¥ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è ...
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
curl -k https://localhost:8443/api/normcontrol2/status
# ‚úÖ {"status":"running","service":"normcontrol2-service","version":"1.0.0"}

# –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
curl -k https://localhost:8443/api/normcontrol2/documents
# ‚úÖ {"success":true,"documents":[...]}

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl -k https://localhost:8443/api/normcontrol2/statistics
# ‚úÖ {"success":true,"statistics":{...}}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
- ‚úÖ –û—à–∏–±–∫–∏ 404 –∏—Å—á–µ–∑–ª–∏
- ‚úÖ API –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:
```
Frontend (https://localhost)
    ‚Üì
Gateway (https://localhost:8443)
    ‚Üì
NormControl2 Service (http://normcontrol2-service:8010)
```

### –ü–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–∞:
1. **Frontend** ‚Üí `https://localhost/api/normcontrol2/status`
2. **Gateway** ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø—Ä–æ–ø—É—Å–∫ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π)
3. **Gateway** ‚Üí –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ normcontrol2-service
4. **Gateway** ‚Üí `http://normcontrol2-service:8010/normcontrol2/status`
5. **NormControl2 Service** ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
6. **Gateway** ‚Üí –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ gateway
docker-compose logs gateway --tail=20

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ normcontrol2-service
docker-compose logs normcontrol2-service --tail=20
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `gateway/app.py` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è normcontrol2
- ‚úÖ –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- ‚úÖ `GET /api/normcontrol2/status`
- ‚úÖ `GET /api/normcontrol2/documents`
- ‚úÖ `GET /api/normcontrol2/statistics`
- ‚úÖ `GET /api/normcontrol2/settings`

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞:
- **404 –æ—à–∏–±–∫–∏** - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- **API –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –†–∞–±–æ—Ç–∞–µ—Ç
- **–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - –î–æ—Å—Ç—É–ø–Ω—ã

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–∫–ª—é—á–µ–Ω–æ
- Health checks —Ä–∞–±–æ—Ç–∞—é—Ç
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª–æ–≥–∏ gateway –∏ normcontrol2-service
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **Rate limiting** - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ú–µ—Ç—Ä–∏–∫–∏** - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–ê–ª–µ—Ä—Ç—ã** - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 12 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** üöÄ –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** üß™ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

